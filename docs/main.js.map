{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils.ts","webpack:///./src/index.ts","webpack:///./src/puzzle-generator.ts","webpack:///./src/drag-handler.ts","webpack:///./src/xml-clone.ts","webpack:///./src/certificate.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","getDefault","getModuleExports","object","property","prototype","hasOwnProperty","p","s","NS_SVG","NS_XHTML","round","Math","Number","EPSILON","getUrl","blob","Promise","resolve","reject","reader","FileReader","readAsDataURL","addEventListener","result","Error","getImageDimensions","src","img","Image","width","naturalWidth","height","naturalHeight","clearChildren","node","hasChildNodes","removeChild","firstChild","formatTime","time","absTime","abs","floor","toString","padStart","getSeed","seed","hash","length","imul","charCodeAt","pathIdMatcher","MainHandler","root","document","baseTime","_xc","_yc","querySelector","classList","remove","this","Document","ownerDocument","defsElement","pathGroup","instanceGroup","timeDisp","dataElement","menuGroup","menuForm","onMenuSubmit","onMenuReset","imageSelector","onImageSelected","colSelector","onColChange","rowSelector","onRowChange","menu","save","imageElement","imageUrl","href","baseVal","assign","registerDraggable","onDrag","onDrop","load","Blob","oldMask","querySelectorAll","startTime","Date","endTime","resumeTime","textContent","timer","clearInterval","paths","JigsawGenerator","undefined","toSvgElements","viewWidth","max","viewHeight","setAttribute","path","mask","appendChild","createElementNS","id","add","maskPath","instance","base","decoPath","exec","w","h","transform","appendItem","createSVGTransform","setTranslate","random","parseInt","window","setInterval","updateTime","state","target","parentNode","x","y","element","checkAndMerge","childElementCount","lastElement","removeItem","showCertificate","current","next","other","closest","isDragging","t1","numberOfItems","t2","m1","getItem","matrix","m2","sqrt","e","f","currentIsGroup","contains","otherIsGroup","child","Array","from","childNodes","newGroup","now","getTime","data","JSON","parse","xCount","yCount","stringify","downloadDocument","files","updateImage","item","valueAsNumber","preventDefault","init","reset","svgArgsCount","M","L","H","V","v","C","S","Q","q","T","A","a","z","tabSize","jitter","radius","strokes","Map","b","flip","trunc","MAX_SAFE_INTEGER","min","sl","sw","vertical","yi","first","xi","pushStroke","generateStroke","points","inst","cells","stroke","getNormalizedStroke","clear","parent","row","elm","push","reverse","p0l","p0w","p1l","p1w","p2l","p2w","p3l","p3w","p4l","p4w","p5l","p5w","p6l","p6w","p7l","p7w","p8l","p8w","p9l","p9w","sin","nextJitter","filp","ol","ow","set","strokeSet","Set","size","found","delete","splice","j","slice","join","draggableClass","handlerClass","draggingElements","states","onStartDrag","onDragging","onEndDrag","capture","passive","getState","identifier","MouseEvent","SVGGraphicsElement","ownerSVGElement","pointer","targetTouches","srcElement","ctm","getScreenCTM","inverse","SVGUseElement","SVGGeometryElement","touch","lp","getLocalPoint","isPointInFill","isPointInStroke","bbox","getBBox","left","right","top","bottom","button","matches","has","transforms","type","SVGTransform","SVG_TRANSFORM_TRANSLATE","insertItemBefore","offset","matrixTransform","offsetX","offsetY","interceptEvent","changedTouches","map","handleDrag","includes","coord","handleEndDrag","createSVGPoint","clientX","clientY","cancelable","defaultPrevented","stopPropagation","async","implementation","createDocument","clone","importNode","replaceChild","all","resolveScript","XMLSerializer","serializeToString","URL","createObjectURL","download","click","revokeObjectURL","script","HTMLScriptElement","removeAttribute","fetch","text","SVGScriptElement","createCDATASection","certificate","timeStartElement","timeEndElement","timeUsedElement","puzzleSizeElement","mainHandler","hideCetificate"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","export const NS_SVG = 'http://www.w3.org/2000/svg';\r\nexport const NS_XHTML = 'http://www.w3.org/1999/xhtml';\r\n\r\nexport function round(n: number, c = 0) {\r\n  c = 10 ** c;\r\n  return Math.round((n + Number.EPSILON) * c) / c;\r\n}\r\n\r\nexport function getUrl(blob: Blob) {\r\n  return new Promise<string>((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(blob);\r\n    reader.addEventListener('loadend', () =>\r\n      resolve(reader.result as string));\r\n    reader.addEventListener('error', () =>\r\n      reject(new Error('Unable to get URL from blob.')));\r\n  });\r\n}\r\n\r\nexport function getImageDimensions(src: string) {\r\n  return new Promise<{ width: number; height: number; }>((resolve, reject) => {\r\n    const img = new Image();\r\n    img.src = src;\r\n    img.addEventListener('load', () => resolve({\r\n      width: img.naturalWidth,\r\n      height: img.naturalHeight,\r\n    }));\r\n    img.addEventListener('error', () =>\r\n      reject(new Error('Could not load image from src.')));\r\n  });\r\n}\r\n\r\nexport function clearChildren(node: Node) {\r\n  while(node.hasChildNodes())\r\n    node.removeChild(node.firstChild!);\r\n}\r\n\r\nexport function formatTime(time: number) {\r\n  const absTime = Math.abs(time);\r\n  let result = `${\r\n    Math.floor(absTime / 6e4 % 60).toString(10).padStart(2, '0')\r\n  }:${\r\n    Math.floor(absTime / 1e3 % 60).toString(10).padStart(2, '0')\r\n  }`;\r\n  if(time < 36e5) return (time < 0 ? '-' : '') + result;\r\n  result = `${\r\n    Math.floor(absTime / 36e5 % 24).toString(10).padStart(2, '0')\r\n  }:${result}`;\r\n  if(time < 864e5) return (time < 0 ? '-' : '') + result;\r\n  return `${\r\n    Math.floor(time / 864e5).toString(10).padStart(2, '0')\r\n  }d ${result}`;\r\n}\r\n\r\nexport function getSeed(seed: any): number {\r\n  switch(typeof seed) {\r\n    case 'undefined':\r\n    case 'object':\r\n      if(seed == null)\r\n        seed = '';\r\n    default:\r\n      seed = seed.toString();\r\n    case 'string': {\r\n      let hash = 0;\r\n      for(let i = 0; i < seed.length; i++)\r\n        hash = Math.imul(31, hash) + seed.charCodeAt(i) | 0;\r\n      seed = hash;\r\n    }\r\n  }\r\n  return seed;\r\n}\r\n","import { JigsawGenerator } from './puzzle-generator';\r\nimport { registerDraggable, DraggingState } from './drag-handler';\r\nimport { formatTime, getUrl, getImageDimensions, clearChildren, NS_SVG } from './utils';\r\nimport { downloadDocument } from './xml-clone';\r\nimport { showCertificate } from './certificate';\r\n\r\nconst pathIdMatcher = /^p-(\\d+)-(\\d+)/;\r\n\r\ninterface StoredData {\r\n  width: number;\r\n  height: number;\r\n  xCount: number;\r\n  yCount: number;\r\n  time: number;\r\n  startTime?: number;\r\n  endTime?: number;\r\n}\r\n\r\nexport class MainHandler {\r\n  document: Document;\r\n  root: SVGSVGElement;\r\n  defsElement: SVGDefsElement;\r\n  imageElement: SVGImageElement;\r\n  pathGroup: SVGGElement;\r\n  instanceGroup: SVGGElement;\r\n  timeDisp: SVGTextElement;\r\n  dataElement: SVGScriptElement;\r\n  menuGroup: SVGGElement;\r\n  menuForm: HTMLFormElement;\r\n  imageSelector: HTMLInputElement;\r\n  colSelector: HTMLInputElement;\r\n  rowSelector: HTMLInputElement;\r\n\r\n  imageUrl: string;\r\n  width: number = 1;\r\n  height: number = 1;\r\n  baseTime: number = 0;\r\n  time: number = 0;\r\n  startTime?: Date;\r\n  endTime?: Date;\r\n  resumeTime?: Date;\r\n  private _xc: number = 1;\r\n  private _yc: number = 1;\r\n  private timer?: number;\r\n\r\n  get xCount() {\r\n    return this._xc;\r\n  }\r\n  set xCount(value: number) {\r\n    this._xc = value;\r\n    this._yc = Math.round(value / this.width * this.height);\r\n  } \r\n\r\n  get yCount() {\r\n    return this._yc;\r\n  }\r\n  set yCount(value: number) {\r\n    this._yc = value;\r\n    this._xc = Math.round(value / this.height * this.width);\r\n  }\r\n\r\n  constructor(root: GlobalEventHandlers & ParentNode = document) {\r\n    root.querySelector('.noscript')?.classList.remove('noscript');\r\n    this.root = root.querySelector('svg')!;\r\n    this.document = root instanceof Document ? root : this.root.ownerDocument;\r\n    this.defsElement = root.querySelector('defs')!;\r\n    this.pathGroup = root.querySelector<SVGGElement>('g#ps')!;\r\n    this.instanceGroup = root.querySelector<SVGGElement>('g#ins')!;\r\n    this.timeDisp = root.querySelector<SVGTextElement>('text#time')!;\r\n    this.dataElement = root.querySelector<SVGScriptElement>('script#data')!;\r\n    this.menuGroup = root.querySelector<SVGGElement>('#menu')!;\r\n    this.menuForm = root.querySelector<HTMLFormElement>('form#menuform')!;\r\n    this.menuForm.addEventListener('submit', this.onMenuSubmit.bind(this));\r\n    this.menuForm.addEventListener('reset', this.onMenuReset.bind(this));\r\n    this.imageSelector = this.menuForm.querySelector<HTMLInputElement>('input#image-input')!;\r\n    this.imageSelector.addEventListener('change', this.onImageSelected.bind(this));\r\n    this.colSelector = this.menuForm.querySelector<HTMLInputElement>('input#col-input')!;\r\n    const onColChange = this.onColChange.bind(this);\r\n    this.colSelector.addEventListener('change', onColChange);\r\n    this.colSelector.addEventListener('blur', onColChange);\r\n    this.rowSelector = this.menuForm.querySelector<HTMLInputElement>('input#row-input')!;\r\n    const onRowChange = this.onRowChange.bind(this);\r\n    this.rowSelector.addEventListener('change', onRowChange);\r\n    this.rowSelector.addEventListener('blur', onRowChange);\r\n    this.root.querySelector('#new-game')?.addEventListener('click', this.menu.bind(this));\r\n    this.root.querySelector('#save-game')?.addEventListener('click', this.save.bind(this));\r\n    this.imageElement = root.querySelector<SVGImageElement>('image#img')!;\r\n    this.imageUrl = this.imageElement.href.baseVal;\r\n    Object.assign(this, registerDraggable(\r\n      root, this.onDrag.bind(this), this.onDrop.bind(this),\r\n    ));\r\n    this.load();\r\n  }\r\n\r\n  async updateImage(src: string | Blob) {\r\n    if(src instanceof Blob)\r\n      src = await getUrl(src);\r\n    const { width, height } = await getImageDimensions(src);\r\n    this.imageUrl = src;\r\n    this.width = width;\r\n    this.height = height;\r\n    this._xc = Math.round(width / 100);\r\n    this._yc = Math.round(height / 100);\r\n  }\r\n\r\n  init() {\r\n    clearChildren(this.pathGroup);\r\n    clearChildren(this.instanceGroup);\r\n    for(const oldMask of this.defsElement.querySelectorAll('mask.puzzle-mask'))\r\n      oldMask.remove();\r\n    this.time = 0;\r\n    this.baseTime = 0;\r\n    this.startTime = new Date();\r\n    delete this.endTime;\r\n    delete this.resumeTime;\r\n    this.timeDisp.textContent = '--:--';\r\n    if(this.timer != null) {\r\n      clearInterval(this.timer);\r\n      delete this.timer;\r\n    }\r\n    const paths = new JigsawGenerator(\r\n      this.width, this.height,\r\n      this._xc, this._yc,\r\n      undefined, undefined, undefined,\r\n      10,\r\n    ).toSvgElements(this.document, this.pathGroup);\r\n    const viewWidth = Math.max(640, this.width * 1.5);\r\n    const viewHeight = Math.max(480, this.height * 1.5);\r\n    this.root.setAttribute('viewbox', `0 0 ${viewWidth} ${viewHeight}`);\r\n    this.root.setAttribute('width', viewWidth.toString(10));\r\n    this.root.setAttribute('height', viewHeight.toString(10));\r\n    this.imageElement.href.baseVal = this.imageUrl;\r\n    this.imageElement.setAttribute('width', this.width.toString());\r\n    this.imageElement.setAttribute('height', this.height.toString());\r\n    for(const path of paths) {\r\n      const mask = this.defsElement.appendChild(this.document.createElementNS(NS_SVG, 'mask'));\r\n      mask.id = `${path.id}-m`;\r\n      mask.classList.add('puzzle-mask');\r\n\r\n      const maskPath = mask.appendChild(this.document.createElementNS(NS_SVG, 'use'));\r\n      maskPath.href.baseVal = `#${path.id}`;\r\n      maskPath.setAttribute('fill', 'white');\r\n\r\n      const instance = this.instanceGroup.appendChild(this.document.createElementNS(NS_SVG, 'g'));\r\n      instance.id = `${path.id}-i`;\r\n      instance.classList.add('draggable');\r\n\r\n      const base = instance.appendChild(this.document.createElementNS(NS_SVG, 'use'));\r\n      base.href.baseVal = `#${this.imageElement.id}`;\r\n      base.setAttribute('mask', `url(#${mask.id})`);\r\n\r\n      const decoPath = instance.appendChild(this.document.createElementNS(NS_SVG, 'use'));\r\n      decoPath.classList.add('handler');\r\n      decoPath.href.baseVal = `#${path.id}`;\r\n      decoPath.setAttribute('stroke', 'black');\r\n      decoPath.setAttribute('fill', 'transparent');\r\n\r\n      const m = pathIdMatcher.exec(path.id);\r\n      if(m) {\r\n        const w = this.width / this._xc;\r\n        const h = this.height / this._yc;\r\n        instance.transform.baseVal.appendItem(this.root.createSVGTransform()).setTranslate(\r\n          Math.round(Math.random() * (viewWidth - w) - parseInt(m[1], 10) * w),\r\n          Math.round(Math.random() * (viewHeight - h) - parseInt(m[2], 10) * h),\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  private onDrag() {\r\n    if(this.timer != null) return;\r\n    this.resumeTime = new Date();\r\n    this.timer = window.setInterval(this.updateTime.bind(this), 1000);\r\n    this.updateTime();\r\n  }\r\n\r\n  private onDrop(state: DraggingState) {\r\n    const { id } = state.target.parentNode as Element;\r\n    const m = pathIdMatcher.exec(id);\r\n    if(!m) return;\r\n    const x = parseInt(m[1], 10);\r\n    const y = parseInt(m[2], 10);\r\n    state.element = this.checkAndMerge(state.element, `#p-${x + 1}-${y}-i`);\r\n    state.element = this.checkAndMerge(state.element, `#p-${x - 1}-${y}-i`);\r\n    state.element = this.checkAndMerge(state.element, `#p-${x}-${y + 1}-i`);\r\n    state.element = this.checkAndMerge(state.element, `#p-${x}-${y - 1}-i`);\r\n    if(this.instanceGroup.childElementCount > 1)\r\n      return;\r\n    this.endTime = new Date();\r\n    if(this.timer != null) {\r\n      clearInterval(this.timer);\r\n      delete this.timer;\r\n    }\r\n    const lastElement = this.instanceGroup.querySelector<SVGGraphicsElement>('.draggable.group');\r\n    if(lastElement) {\r\n      lastElement.classList.remove('draggable');\r\n      lastElement.transform.baseVal.removeItem(0);\r\n    }\r\n    showCertificate(this);\r\n  }\r\n\r\n  private checkAndMerge(current: SVGGraphicsElement, next: string) {\r\n    const other = this.instanceGroup.querySelector(next)?.closest<SVGGraphicsElement>('.draggable');\r\n    if(!other || this.isDragging(other) || other === current)\r\n      return current;\r\n    const t1 = current.transform.baseVal;\r\n    if(!t1.numberOfItems) return current;\r\n    const t2 = other.transform.baseVal;\r\n    if(!t2.numberOfItems) return current;\r\n    const m1 = t1.getItem(0).matrix;\r\n    const m2 = t2.getItem(0).matrix;\r\n    if(Math.sqrt((m1.e - m2.e) ** 2 + (m1.f - m2.f) ** 2) > 3)\r\n      return current;\r\n    const currentIsGroup = current.classList.contains('group');\r\n    const otherIsGroup = other.classList.contains('group');\r\n    if(currentIsGroup) {\r\n      if(otherIsGroup) {\r\n        for(const child of Array.from(other.childNodes))\r\n          current.appendChild(child);\r\n        other.remove();\r\n      } else {\r\n        other.classList.remove('draggable');\r\n        t2.removeItem(0);\r\n        current.appendChild(other);\r\n      }\r\n      return current;\r\n    }\r\n    if(otherIsGroup) {\r\n      current.classList.remove('draggable');\r\n      t1.removeItem(0);\r\n      other.appendChild(current);\r\n      return other;\r\n    }\r\n    const newGroup = current.parentNode!.appendChild(this.document.createElementNS(NS_SVG, 'g'));\r\n    newGroup.classList.add('draggable', 'group');\r\n    newGroup.appendChild(current);\r\n    current.classList.remove('draggable');\r\n    newGroup.appendChild(other);\r\n    other.classList.remove('draggable');\r\n    const t = t2.getItem(0);\r\n    t1.removeItem(0);\r\n    t2.removeItem(0);\r\n    newGroup.transform.baseVal.appendItem(t);\r\n    return newGroup;\r\n  }\r\n\r\n  private isDragging(element: SVGElement) {\r\n    return false;\r\n  }\r\n\r\n  private updateTime() {\r\n    this.time = Date.now() - this.resumeTime!.getTime() + this.baseTime;\r\n    this.timeDisp.textContent = formatTime(this.time);\r\n  }\r\n\r\n  private menu() {\r\n    this.menuGroup.classList.add('show');\r\n  }\r\n\r\n  private load() {\r\n    const data: StoredData | null = JSON.parse(this.dataElement.textContent || 'null');\r\n    if(data == null)\r\n      return;\r\n    this.width = data.width;\r\n    this.height = data.height;\r\n    this.baseTime = data.time;\r\n    this._xc = data.xCount;\r\n    this._yc = data.yCount;\r\n    if(data.startTime != null)\r\n      this.startTime = new Date(data.startTime);\r\n    if(data.endTime != null)\r\n      this.endTime = new Date(data.endTime);\r\n  }\r\n\r\n  private save() {\r\n    if(this.resumeTime != null) this.updateTime();\r\n    this.dataElement.textContent = JSON.stringify({\r\n      width: this.width,\r\n      height: this.height,\r\n      xCount: this._xc,\r\n      yCount: this._yc,\r\n      startTime: this.startTime?.getTime(),\r\n      endTime: this.endTime?.getTime(),\r\n      time: this.time,\r\n    } as StoredData);\r\n    return downloadDocument(this.root, `puzzle-${Date.now()}.svg`);\r\n  }\r\n\r\n  private async onImageSelected() {\r\n    const { files } = this.imageSelector;\r\n    if(!files || !files.length) return;\r\n    await this.updateImage(files.item(0)!);\r\n    this.colSelector.valueAsNumber = this.xCount = Math.round(this.width / 100);\r\n    this.rowSelector.valueAsNumber = this.yCount;\r\n  }\r\n\r\n  private onColChange() {\r\n    this.xCount = this.colSelector.valueAsNumber;\r\n    this.rowSelector.valueAsNumber = this.yCount;\r\n  }\r\n\r\n  private onRowChange() {\r\n    this.yCount = this.rowSelector.valueAsNumber;\r\n    this.colSelector.valueAsNumber = this.xCount;\r\n  }\r\n\r\n  private async onMenuSubmit(e: Event) {\r\n    e.preventDefault();\r\n    if(!this.imageUrl) return;\r\n    this.init();\r\n    this.menuForm.reset();\r\n  }\r\n\r\n  private onMenuReset() {\r\n    this.menuGroup.classList.remove('show');\r\n  }\r\n}\r\n\r\nnew MainHandler();\r\n","import { NS_SVG, getSeed, round } from './utils';\r\n// Modified from https://gist.github.com/Draradech/35d36347312ca6d0887aa7d55f366e30\r\n// Changes: Outputs per-puzzle path instead of one for all.\r\n\r\ninterface Stroke {\r\n  points: number[];\r\n  inst: string[];\r\n}\r\n\r\nconst svgArgsCount: { [arg: string]: number; } = {\r\n  M: 2, m: 2,\r\n  L: 2, l: 2,\r\n  H: 1, h: 1,\r\n  V: 1, v: 1,\r\n  C: 6, c: 6,\r\n  S: 4, s: 4,\r\n  Q: 4, q: 4,\r\n  T: 2, t: 2,\r\n  A: 7, a: 7,\r\n  z: 0,\r\n};\r\n\r\nexport class JigsawGenerator {\r\n  cells: string[][];\r\n\r\n  private strokes = new Map<number, Stroke[]>();\r\n  private a: number = 0;\r\n  private b: number = 0;\r\n  private c: number = 0;\r\n  private d: number = 0;\r\n  private e: number = 0;\r\n  private flip: boolean = false;\r\n  private xi: number;\r\n  private yi: number;\r\n  private vertical: boolean;\r\n  private get sl() { return this.vertical ? this.height / this.yCount : this.width / this.xCount; }\r\n  private get sw() { return this.vertical ? this.width / this.xCount : this.height / this.yCount; }\r\n  private get ol() { return this.sl * (this.vertical ? this.yi : this.xi); }\r\n  private get ow() { return this.sw * (this.vertical ? this.xi : this.yi); }\r\n\r\n  constructor(\r\n    public width: number,\r\n    public height: number,\r\n    public xCount: number,\r\n    public yCount: number,\r\n    public seed?: any,\r\n    public tabSize: number = 0.1,\r\n    public jitter: number = 0.04,\r\n    public radius: number = 0,\r\n  ) {\r\n    this.seed = getSeed(seed ?? Math.trunc(Math.random() * Number.MAX_SAFE_INTEGER));\r\n    this.radius = Math.min(this.radius, this.sl, this.sw);\r\n\r\n    this.vertical = false;\r\n    for(this.yi = 1; this.yi < this.yCount; this.yi++) {\r\n      this.first();\r\n      for(this.xi = 0; this.xi < this.xCount; this.xi++) {\r\n        this.next();\r\n        this.pushStroke(this.xi + this.xCount * (this.yi - 1), this.generateStroke(true));\r\n        this.pushStroke(this.xi + this.xCount * this.yi, this.generateStroke());\r\n      }\r\n    }\r\n\r\n    this.vertical = true;\r\n    for(this.xi = 1; this.xi < this.xCount; this.xi++) {\r\n      this.first();\r\n      for(this.yi = 0; this.yi < this.yCount; this.yi++) {\r\n        this.next();\r\n        this.pushStroke(this.xi - 1 + this.xCount * this.yi, this.generateStroke());\r\n        this.pushStroke(this.xi + this.xCount * this.yi, this.generateStroke(true));\r\n      }\r\n    }\r\n\r\n    this.vertical = false;\r\n    this.pushStroke(0, {\r\n      points: [\r\n        0, round(this.sw, 3),\r\n        0, this.radius,\r\n        this.radius, this.radius, 0, 0, 1,\r\n        this.radius, 0,\r\n      ],\r\n      inst: ['M', 'L', 'A'],\r\n    });\r\n\r\n    this.vertical = true;\r\n    this.pushStroke(this.xCount - 1, {\r\n      points: [\r\n        round(this.width - this.sw), 0,\r\n        this.width - this.radius, 0,\r\n        this.radius, this.radius, 0, 0, 1,\r\n        this.width, this.radius,\r\n      ],\r\n      inst: ['M', 'L', 'A'],\r\n    });\r\n\r\n    this.vertical = false;\r\n    this.pushStroke(this.xCount * this.yCount - 1, {\r\n      points: [\r\n        this.width, round(this.height - this.sw, 3),\r\n        this.width, this.height - this.radius,\r\n        this.radius, this.radius, 0, 0, 1,\r\n        this.width - this.radius, this.height,\r\n      ],\r\n      inst: ['M', 'L', 'A'],\r\n    });\r\n\r\n    this.vertical = true;\r\n    this.pushStroke(this.xCount * (this.yCount - 1), {\r\n      points: [\r\n        round(this.sw, 3), this.height,\r\n        this.radius, this.height,\r\n        this.radius, this.radius, 0, 0, 1, 0,\r\n        this.height - this.radius,\r\n      ],\r\n      inst: ['M', 'L', 'A'],\r\n    });\r\n\r\n    this.cells = [];\r\n    for(const [i, stroke] of this.strokes) {\r\n      const y = Math.trunc(i / this.xCount);\r\n      (this.cells[y] ?? (this.cells[y] = []))[i % this.xCount] = this.getNormalizedStroke(stroke);\r\n    }\r\n\r\n    this.strokes.clear();\r\n  }\r\n\r\n  toSvgElements(document: Document, parent?: SVGElement) {\r\n    const result: SVGPathElement[] = [];\r\n    for(let y = 0; y < this.cells.length; y++) {\r\n      const row = this.cells[y];\r\n      for(let x = 0; x < row.length; x++) {\r\n        const elm = document.createElementNS(NS_SVG, 'path');\r\n        elm.setAttribute('d', row[x]);\r\n        elm.id = `p-${x}-${y}`;\r\n        result.push(elm);\r\n        parent?.appendChild(elm);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n\r\n  private generateStroke(reverse?: boolean): Stroke {\r\n    const { a, b, c, d, e, tabSize } = this;\r\n    const p0l = this.l(0);\r\n    const p0w = this.w(0);\r\n    const p1l = this.l(0.2);\r\n    const p1w = this.w(a);\r\n    const p2l = this.l(0.5 + b + d);\r\n    const p2w = this.w(-tabSize + c);\r\n    const p3l = this.l(0.5 - tabSize + b);\r\n    const p3w = this.w(tabSize + c);\r\n    const p4l = this.l(0.5 - 2 * tabSize + b - d);\r\n    const p4w = this.w(3 * tabSize + c);\r\n    const p5l = this.l(0.5 + 2 * tabSize + b - d);\r\n    const p5w = this.w(3 * tabSize + c);\r\n    const p6l = this.l(0.5 + tabSize + b);\r\n    const p6w = this.w(tabSize + c);\r\n    const p7l = this.l(0.5 + b + d);\r\n    const p7w = this.w(-tabSize + c);\r\n    const p8l = this.l(0.8);\r\n    const p8w = this.w(e);\r\n    const p9l = this.l(1);\r\n    const p9w = this.w(0);\r\n    return {\r\n      points: this.vertical ? reverse ? [\r\n        p9w, p9l, p8w, p8l, p7w, p7l, p6w, p6l,\r\n        p5w, p5l, p4w, p4l, p3w, p3l, p2w, p2l,\r\n        p1w, p1l, p0w, p0l,\r\n      ] : [\r\n        p0w, p0l, p1w, p1l, p2w, p2l, p3w, p3l,\r\n        p4w, p4l, p5w, p5l, p6w, p6l, p7w, p7l,\r\n        p8w, p8l, p9w, p9l,\r\n      ] : reverse ? [\r\n        p9l, p9w, p8l, p8w, p7l, p7w, p6l, p6w,\r\n        p5l, p5w, p4l, p4w, p3l, p3w, p2l, p2w,\r\n        p1l, p1w, p0l, p0w,\r\n      ] : [\r\n        p0l, p0w, p1l, p1w, p2l, p2w, p3l, p3w,\r\n        p4l, p4w, p5l, p5w, p6l, p6w, p7l, p7w,\r\n        p8l, p8w, p9l, p9w,\r\n      ],\r\n      inst: ['M', 'C', 'C', 'C'],\r\n    };\r\n  }\r\n\r\n  private random() {\r\n    const x = Math.sin(this.seed++) * 10000;\r\n    return x - Math.floor(x);\r\n  }\r\n\r\n  private nextJitter() {\r\n    return this.random() * this.jitter * 2 - this.jitter;\r\n  }\r\n\r\n  private first() {\r\n    this.e = this.nextJitter();\r\n  }\r\n\r\n  private next() {\r\n    const filp = this.flip;\r\n    this.flip = this.random() >= 0.5;\r\n    this.a = (this.flip === filp ? -this.e : this.e);\r\n    this.b = this.nextJitter();\r\n    this.c = this.nextJitter();\r\n    this.d = this.nextJitter();\r\n    this.e = this.nextJitter();\r\n  }\r\n\r\n  private l(v: number) {\r\n    return round(this.ol + this.sl * v, 3);\r\n  }\r\n\r\n  private w(v: number) {\r\n    return round(this.ow + this.sw * v * (this.flip ? -1 : 1), 3);\r\n  }\r\n\r\n  private pushStroke(i: number, stroke: Stroke) {\r\n    const strokes = this.strokes.get(i);\r\n    if(strokes)\r\n      strokes.push(stroke);\r\n    else\r\n      this.strokes.set(i, [stroke]);\r\n  }\r\n\r\n  private getNormalizedStroke(strokes: Stroke[]) {\r\n    if(strokes == null || !strokes.length)\r\n      return '';\r\n    if(strokes.length > 1) {\r\n      const strokeSet = new Set(strokes);\r\n      const result: Stroke = { points: [], inst: [] };\r\n      while(strokeSet.size) {\r\n        let found = false;\r\n        for(const other of strokeSet)\r\n          if(!result.points.length) {\r\n            result.points = other.points;\r\n            result.inst = other.inst;\r\n            found = true;\r\n            strokeSet.delete(other);\r\n            break;\r\n          } else if(\r\n            Math.abs(result.points[0] - other.points[other.points.length - 2]) < 1 &&\r\n            Math.abs(result.points[1] - other.points[other.points.length - 1]) < 1\r\n          ) {\r\n            result.points.splice(0, 2, ...other.points);\r\n            result.inst.splice(0, 1, ...other.inst);\r\n            found = true;\r\n            strokeSet.delete(other);\r\n            break;\r\n          } else if(\r\n            Math.abs(other.points[0] - result.points[result.points.length - 2]) < 1 &&\r\n            Math.abs(other.points[1] - result.points[result.points.length - 1]) < 1\r\n          ) {\r\n            other.points.splice(0, 2, ...result.points);\r\n            other.inst.splice(0, 1, ...result.inst);\r\n            result.points = other.points;\r\n            result.inst = other.inst;\r\n            found = true;\r\n            strokeSet.delete(other);\r\n            break;\r\n          }\r\n        if(!found)\r\n          break;\r\n      }\r\n      strokes = [result];\r\n    }\r\n    const { points, inst } = strokes[0];\r\n    let j = 0;\r\n    let result = '';\r\n    for(const i of inst) {\r\n      result += i;\r\n      const c = svgArgsCount[i];\r\n      if(c) result += points.slice(j, j += c).join(' ');\r\n    }\r\n    return result + 'z';\r\n  }\r\n}\r\n","export interface DraggingState {\r\n  target: SVGGraphicsElement;\r\n  element: SVGGraphicsElement;\r\n  identifier?: number;\r\n  transform: SVGTransform;\r\n  offsetX: number;\r\n  offsetY: number;\r\n}\r\n\r\nexport function registerDraggable(\r\n  root: GlobalEventHandlers = document,\r\n  onDrag?: (element: SVGElement) => void,\r\n  onDrop?: (state: DraggingState) => void,\r\n  draggableClass = '.draggable', handlerClass = '.handler',\r\n) {\r\n  const draggingElements = new Map<SVGElement, DraggingState>();\r\n  const states = new Map<number | undefined, DraggingState>();\r\n\r\n  root.addEventListener('mousedown', onStartDrag, true);\r\n  root.addEventListener('mousemove', onDragging);\r\n  root.addEventListener('mouseup', onEndDrag);\r\n  root.addEventListener('mouseleave', onEndDrag);\r\n  root.addEventListener('touchstart', onStartDrag, { capture: true, passive: false });\r\n  root.addEventListener('touchmove', onDragging, { passive: false });\r\n  root.addEventListener('touchend', onEndDrag, { passive: false });\r\n  root.addEventListener('touchcancel', onEndDrag, { passive: false });\r\n\r\n  function getState(e: MouseEvent | Touch) {\r\n    const state = states.get((e as Touch).identifier);\r\n    return state && (state.identifier == null) === (e instanceof MouseEvent) ? state : null;\r\n  }\r\n\r\n  function onStartDrag(e: MouseEvent | TouchEvent) {\r\n    let target = (e.target as Element)?.closest?.(`${draggableClass} ${handlerClass}, ${draggableClass}${handlerClass}`);\r\n    if(!(target instanceof SVGGraphicsElement)) return;\r\n    const root = target.ownerSVGElement!;\r\n    let pointer: Touch | MouseEvent | undefined;\r\n    let identifier: number | undefined;\r\n    const { targetTouches } = e as TouchEvent;\r\n    if(targetTouches) {\r\n      let srcElement: Element | null | undefined = target;\r\n      const ctm = (target.parentNode as SVGGraphicsElement)?.getScreenCTM?.()?.inverse();\r\n      while(srcElement) {\r\n        if(srcElement instanceof SVGUseElement) {\r\n          srcElement = root.querySelector(srcElement.href.baseVal);\r\n          continue;\r\n        }\r\n        if(srcElement instanceof SVGGeometryElement) {\r\n          for(let i = 0; i < targetTouches.length; i++) {\r\n            const touch = targetTouches[i];\r\n            const lp = getLocalPoint(root, touch, ctm);\r\n            if(srcElement.isPointInFill(lp) || srcElement.isPointInStroke(lp)) {\r\n              identifier = touch.identifier;\r\n              pointer = touch;\r\n              break;\r\n            }\r\n          }\r\n        } else if(srcElement instanceof SVGGraphicsElement) {\r\n          const bbox = target.getBBox();\r\n          for(let i = 0; i < targetTouches.length; i++) {\r\n            const touch = targetTouches[i];\r\n            const lp = getLocalPoint(root, touch, ctm);\r\n            if(bbox.left <= lp.x && bbox.right > lp.x &&\r\n              bbox.top <= lp.y && bbox.bottom > lp.y) {\r\n              identifier = touch.identifier;\r\n              pointer = touch;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n        break;\r\n      }\r\n    } else {\r\n      if((e as MouseEvent).button !== 0)\r\n        return;\r\n      pointer = e as MouseEvent;\r\n    }\r\n    if(!pointer) return;\r\n    const element = target.matches(draggableClass) ? target : target?.closest<SVGGraphicsElement>(draggableClass) as SVGGraphicsElement;\r\n    if(draggingElements.has(element)) return;\r\n    const transforms = element.transform.baseVal;\r\n    if(!transforms.numberOfItems || transforms.getItem(0).type !== SVGTransform.SVG_TRANSFORM_TRANSLATE) {\r\n      const transform = root.createSVGTransform();\r\n      transform.setTranslate(0, 0);\r\n      transforms.insertItemBefore(transform, 0);\r\n    }\r\n    const transform = transforms.getItem(0);\r\n    const offset = getLocalPoint(\r\n      root, pointer, element.parentNode! as SVGGraphicsElement,\r\n    ).matrixTransform(transform.matrix.inverse());\r\n    const state: DraggingState = {\r\n      element, target, identifier, transform,\r\n      offsetX: offset.x,\r\n      offsetY: offset.y,\r\n    };\r\n    draggingElements.set(element, state);\r\n    states.set(identifier, state);\r\n    element.parentNode?.appendChild(element);\r\n    interceptEvent(e);\r\n    onDrag?.(element);\r\n  }\r\n  \r\n  function onDragging(e: MouseEvent | TouchEvent) {\r\n    if(!states.size) return;\r\n    const { changedTouches } = e as TouchEvent;\r\n    if(changedTouches ?\r\n      Array.prototype.map.call(changedTouches, handleDrag).includes(true) :\r\n      ((e as MouseEvent).button === 0 && handleDrag(e as MouseEvent)))\r\n      interceptEvent(e);\r\n  }\r\n  \r\n  function handleDrag(e: MouseEvent | Touch) {\r\n    const state = getState(e);\r\n    if(!state) return false;\r\n    const coord = getLocalPoint(\r\n      state.element.ownerSVGElement!, e,\r\n      state.element.parentNode! as SVGGraphicsElement,\r\n    );\r\n    if(!coord) return false;\r\n    state.transform.setTranslate(\r\n      coord.x - state.offsetX,\r\n      coord.y - state.offsetY,\r\n    );\r\n    return true;\r\n  }\r\n  \r\n  function onEndDrag(e: MouseEvent | TouchEvent) {\r\n    if(!states.size) return;\r\n    const { changedTouches } = e as TouchEvent;\r\n    if(changedTouches ?\r\n      Array.prototype.map.call(changedTouches, handleEndDrag).includes(true) :\r\n      handleEndDrag(e as MouseEvent))\r\n      interceptEvent(e);\r\n  }\r\n  \r\n  function handleEndDrag(e: MouseEvent | Touch) {\r\n    const state = getState(e);\r\n    if(!state) return false;\r\n    draggingElements.delete(state.element);\r\n    states.delete(state.identifier);\r\n    onDrop?.(state);\r\n    return true;\r\n  }\r\n\r\n  return {\r\n    isDragging(element: SVGElement) {\r\n      return draggingElements.has(element);\r\n    },\r\n  };\r\n}\r\n\r\nfunction getLocalPoint(\r\n  root: SVGSVGElement,\r\n  pointer: MouseEvent | Touch,\r\n  base?: DOMMatrix | SVGGraphicsElement | null,\r\n) {\r\n  const p = root.createSVGPoint();\r\n  p.x = pointer.clientX;\r\n  p.y = pointer.clientY;\r\n  return base != null ? p.matrixTransform(\r\n    base instanceof SVGGraphicsElement ?\r\n    base.getScreenCTM()!.inverse() :\r\n    base,\r\n  ) : p;\r\n}\r\n\r\nfunction interceptEvent(e: Event) {\r\n  if(e.cancelable && !e.defaultPrevented)\r\n    e.preventDefault();\r\n  e.stopPropagation();\r\n}","import { NS_SVG, NS_XHTML } from './utils';\r\n\r\nexport async function downloadDocument(src: Element, name: string) {\r\n  const document = src.ownerDocument;\r\n  const root = document.implementation.createDocument(NS_SVG, 'svg', null);\r\n  const clone = root.importNode(src, true);\r\n  root.replaceChild(clone, root.firstChild!);\r\n  await Promise.all(Array.prototype.map.call(clone.querySelectorAll('script'), resolveScript));\r\n  const blob = new Blob([new XMLSerializer().serializeToString(root)], { type: 'image/svg+xml' });\r\n  const element = document.createElementNS(NS_XHTML, 'a') as HTMLAnchorElement;\r\n  element.href = URL.createObjectURL(blob);\r\n  element.download = name;\r\n  element.click();\r\n  URL.revokeObjectURL(element.href);\r\n}\r\n\r\nasync function resolveScript(script: Element) {\r\n  if(script instanceof HTMLScriptElement) {\r\n    const { src } = script;\r\n    if(!src) return;\r\n    script.removeAttribute('src');\r\n    script.textContent = await (await fetch(src)).text();\r\n  } else if(script instanceof SVGScriptElement) {\r\n    const href = script.href.baseVal;\r\n    if(!href) return;\r\n    script.removeAttribute('href');\r\n    script.appendChild(script.ownerDocument.createCDATASection(await (await fetch(href)).text()));\r\n  }\r\n}","import { MainHandler } from '.';\r\nimport { formatTime } from './utils';\r\n\r\nconst certificate = document.querySelector('#certificate')!;\r\nconst timeStartElement = certificate.querySelector<SVGTextElement>('text#time-start')!;\r\nconst timeEndElement = certificate.querySelector<SVGTextElement>('text#time-end')!;\r\nconst timeUsedElement = certificate.querySelector<SVGTextElement>('text#time-used')!;\r\nconst puzzleSizeElement = certificate.querySelector<SVGTextElement>('test#puzzle-size')!;\r\n\r\nexport function showCertificate(mainHandler: MainHandler) {\r\n  if(!certificate) return;\r\n  certificate.classList.add('show');\r\n  certificate.setAttribute('visibility', 'visible');\r\n  certificate.setAttribute('pointer-events', 'visible');\r\n  timeStartElement.textContent = mainHandler.startTime?.toString() ?? '';\r\n  timeEndElement.textContent = mainHandler.endTime?.toString() ?? '';\r\n  timeUsedElement.textContent = formatTime(mainHandler.time);\r\n  puzzleSizeElement.textContent = `${mainHandler.xCount}${mainHandler.yCount} (${mainHandler.xCount * mainHandler.yCount}Pieces)`;\r\n}\r\n\r\nexport function hideCetificate() {\r\n  certificate?.classList.remove('show');\r\n  timeStartElement.textContent = '';\r\n  timeEndElement.textContent = '';\r\n  timeUsedElement.textContent = '';\r\n  puzzleSizeElement.textContent = '';\r\n}"],"sourceRoot":""}