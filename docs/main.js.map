{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils.ts","webpack:///./src/index.ts","webpack:///./src/puzzle-generator.ts","webpack:///./src/drag-handler.ts","webpack:///./src/xml-clone.ts","webpack:///./src/certificate.ts","webpack:///./src/dropzone.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","getDefault","getModuleExports","object","property","prototype","hasOwnProperty","p","s","NS_SVG","NS_XHTML","CDATA_END","String","fromCharCode","spaceMatcher","trimmableMatcher","styleSpaceMatcher","round","Math","Number","EPSILON","getUrl","blob","Promise","resolve","reject","reader","FileReader","readAsDataURL","addEventListener","result","Error","getImageDimensions","src","img","Image","width","naturalWidth","height","naturalHeight","clearChildren","node","textContent","hasChildNodes","removeChild","firstChild","formatNumber","digits","toString","padStart","formatTime","time","absTime","abs","floor","formatDateTime","date","Date","yr","getFullYear","mo","getMonth","dy","getDate","hr","getHours","mi","getMinutes","se","getSeconds","getSeed","seed","hash","length","imul","charCodeAt","transferChildren","dest","childElementCount","frag","ownerDocument","createDocumentFragment","Array","from","childNodes","forEach","appendChild","interceptEvent","e","cancelable","defaultPrevented","preventDefault","stopPropagation","toPromise","thisArg","args","findStyle","selector","root","window","document","styleElements","querySelectorAll","lastSheet","sheet","j","rules","rule","type","CSSRule","STYLE_RULE","targetSelector","selectorText","split","trim","documentElement","SVGElement","createElementNS","head","createElement","index","insertRule","cssRules","pathIdMatcher","MainHandler","baseTime","theshold","_xc","_yc","querySelector","classList","remove","this","registerDropZone","Document","masksElement","uiScaleRule","pathGroup","instanceGroup","timeDisp","dataElement","menuGroup","menuForm","onMenuSubmit","onMenuReset","onPaste","onDragDrop","imageSelector","onImageSelected","colSelector","onColChange","rowSelector","onRowChange","sizeCountDisplay","fixedPatternCheckbox","imagePreview","submitButton","menu","save","imageElement","onWindowResize","assign","registerDraggable","onDrag","onDrop","load","isFinite","blobOrSrc","Blob","imageUrl","xCount","valueAsNumber","yCount","onSizeChange","startsWith","URL","revokeObjectURL","createObjectURL","disabled","max","sqrt","hideCetificate","unitSize","startTime","calculateTheshold","endTime","resumeTime","timer","clearInterval","paths","JigsawGenerator","radius","min","fixedPattern","checked","toSvgElements","viewWidth","viewHeight","setAttribute","href","baseVal","defs","path","mask","id","maskPath","instance","add","base","decoPath","exec","w","h","transform","appendItem","createSVGTransform","setTranslate","random","parseInt","serializeToData","element","setInterval","updateTime","state","target","parentNode","x","y","checkAndMerge","lastElement","removeItem","showCertificate","current","next","other","closest","isDragging","t1","numberOfItems","t2","m1","getItem","matrix","m2","f","currentIsGroup","contains","otherIsGroup","newGroup","now","getTime","data","JSON","parse","stringify","downloadDocument","beforeSave","files","file","item","updateImage","init","reset","innerWidth","innerHeight","viewBox","viewRatio","windowRatio","scale","devicePixelRatio","style","clipboardData","dataTransfer","loaded","items","kind","getAsFile","row","getAsString","fetch","setScale","svgArgsCount","M","L","H","V","v","C","S","Q","q","T","A","a","z","options","strokes","Map","b","flip","tabSize","jitter","trunc","MAX_SAFE_INTEGER","sl","sw","vertical","yi","first","xi","pushStroke","generateStroke","points","inst","cells","stroke","getNormalizedStroke","clear","parent","fragment","elm","push","reverse","p0l","p0w","p1l","p1w","p2l","p2w","p3l","p3w","p4l","p4w","p5l","p5w","p6l","p6w","p7l","p7w","p8l","p8w","p9l","p9w","sin","nextJitter","filp","ol","ow","set","strokeSet","Set","size","found","delete","splice","slice","join","draggableClass","handlerClass","draggingElements","states","onMouseStartDrag","onMouseDragging","onMouseEndDrag","onTouchStartDrag","capture","passive","onTouchDragging","onTouchEndDrag","getState","identifier","MouseEvent","getHandlerTarget","Element","SVGGraphicsElement","button","handleStartDrag","ctrlKey","shiftKey","pointer","targetTouches","forceBringToFront","ownerSVGElement","matches","has","transforms","SVGTransform","SVG_TRANSFORM_TRANSLATE","insertItemBefore","offset","getLocalPoint","matrixTransform","inverse","offsetX","offsetY","nextSibling","bringToFrontAfter","handleDrag","changedTouches","map","includes","coord","handleEndDrag","createSVGPoint","clientX","clientY","getScreenCTM","async","treatments","implementation","createDocument","clone","importNode","replaceChild","all","resolveScript","minifyStyle","removeWhiteSpaces","XMLSerializer","serializeToString","download","click","script","HTMLScriptElement","removeAttribute","text","SVGScriptElement","createCDATASection","treeWalker","createTreeWalker","NodeFilter","SHOW_TEXT","removals","checkSpaces","nextNode","Text","CDATASection","test","wholeText","whiteSpace","original","changed","replaceAll","replaceWith","createTextNode","child","cdata","certificate","timeStartElement","timeEndElement","timeUsedElement","puzzleSizeElement","mainHandler","dropCallback","dragEnterCallback","dragOverCallback","dragLeaveCallback","dragOverFallbackHandler","defaultDragOverHandler","wrapDragEvent","callback","dropEffect"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GAAW,CAC9B,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,EAAG,MACHH,QAAS,IAIVI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,EAAI,KAGX,OAAOF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC/C,IAAIZ,EAAoBa,EAAEX,EAASS,GAAO,CACzCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,WAAY,KAAMC,IAAKL,MAKhEZ,EAAoBkB,EAAI,SAAShB,GAChC,UAAUiB,SAAW,aAAeA,OAAOC,YAAa,CACvDN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,MAAO,QAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GACvC,GAAGA,EAAO,EAAGF,EAAQrB,EAAoBqB,GACzC,GAAGE,EAAO,EAAG,OAAOF,EACpB,GAAIE,EAAO,UAAaF,IAAU,UAAYA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MACvB1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,WAAY,KAAMK,MAAOA,IAChE,GAAGE,EAAO,UAAYF,GAAS,SAAU,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,SAASM,IAAe,OAAO3B,EAAO,YACtC,SAAS4B,IAAqB,OAAO5B,GACtCH,EAAoBU,EAAEE,EAAQ,IAAKA,GACnC,OAAOA,GAIRZ,EAAoBa,EAAI,SAASmB,EAAQC,GAAY,OAAOnB,OAAOoB,UAAUC,eAAe5B,KAAKyB,EAAQC,IAGzGjC,EAAoBoC,EAAI,GAIxB,OAAOpC,EAAoBA,EAAoBqC,EAAI,I;mRClFxC,EAAAC,OAAS,6BACT,EAAAC,SAAW,+BACX,EAAAC,UAAYC,OAAOC,aAAa,GAAM,GAAM,IAE5C,EAAAC,aAAe,QACf,EAAAC,iBAAmB,aACnB,EAAAC,kBAAoB,qCAEjC,SAAgBC,EAAMjB,EAAWpB,EAAI,GACnCA,EAAI,IAAMA,EACV,OAAOsC,KAAKD,OAAOjB,EAAImB,OAAOC,SAAWxC,GAAKA,EAFhD,UAKA,SAAgByC,EAAOC,GACrB,OAAO,IAAIC,QAAgB,CAACC,EAASC,KACnC,MAAMC,EAAS,IAAIC,WACnBD,EAAOE,cAAcN,GACrBI,EAAOG,iBAAiB,UAAW,IACjCL,EAAQE,EAAOI,SACjBJ,EAAOG,iBAAiB,QAAS,IAC/BJ,EAAO,IAAIM,MAAM,oCAPvB,WAWA,SAAgBC,EAAmBC,GACjC,OAAO,IAAIV,QAA4C,CAACC,EAASC,KAC/D,MAAMS,EAAM,IAAIC,MAChBD,EAAID,IAAMA,EACVC,EAAIL,iBAAiB,OAAQ,IAAML,EAAQ,CACzCY,MAAOF,EAAIG,aACXC,OAAQJ,EAAIK;CAEdL,EAAIL,iBAAiB,QAAS,IAC5BJ,EAAO,IAAIM,MAAM,sCATvB,uBAaA,SAAgBS,EAAcC,GAC5BA,EAAKC,YAAc,GACnB,MAAMD,EAAKE,gBACTF,EAAKG,YAAYH,EAAKI,YAH1B,kBAMA,SAAgBC,EAAa9C,EAAW+C,GACtC,OAAO/C,EAAEgD,SAAS,IAAIC,SAASF,EAAQ,KADzC,iBAIA,SAAgBG,EAAWC,GACzB,MAAMC,EAAUlC,KAAKmC,IAAIF,GACzB,IAAIrB,EAAS,GACXgB,EAAa5B,KAAKoC,MAAMF,EAAU,IAAM,IAAK,MAE7CN,EAAa5B,KAAKoC,MAAMF,EAAU,IAAM,IAAK,KAE/C,GAAGD,EAAO,KAAM,OAAQA,EAAO,EAAI,IAAM,IAAMrB,EAC/CA,EAAS,GACPgB,EAAa5B,KAAKoC,MAAMF,EAAU,KAAO,IAAK,MAC5CtB,IACJ,GAAGqB,EAAO,MAAO,OAAQA,EAAO,EAAI,IAAM,IAAMrB,EAChD,MAAO,GACLgB,EAAa5B,KAAKoC,MAAMH,EAAO,OAAQ,OACpCrB,IAdP,eAiBA,SAAgByB,EAAeC,EAAa,IAAIC,MAC9C,MAAMC,EAAKF,EAAKG,cAChB,MAAMC,EAAKJ,EAAKK,WAChB,MAAMC,EAAKN,EAAKO,UAChB,MAAMC,EAAKR,EAAKS,WAChB,MAAMC,EAAKV,EAAKW,aAChB,MAAMC,EAAKZ,EAAKa,aAChB,MAAO,GACLvB,EAAagB,EAAI,MAEjBhB,EAAac,EAAK,EAAG,MAErBd,EAAaY,EAAI,MAEjBZ,EAAakB,EAAK,IAAM,GAAI,MAE5BlB,EAAaoB,EAAI,MAEjBpB,EAAasB,EAAI,MACfJ,GAAM,GAAK,KAAO,OAnBxB,mBAsBA,SAAgBM,EAAQC,GACtB,cAAcA,GACZ,IAAK,YACL,IAAK,SACH,GAAGA,GAAQ,KACTA,EAAO,GACX,QACEA,EAAOA,EAAKvB,WACd,IAAK,SAAU,CACb,IAAIwB,EAAO,EACX,IAAI,IAAIjG,EAAI,EAAGA,EAAIgG,EAAKE,OAAQlG,IAC9BiG,EAAOtD,KAAKwD,KAAK,GAAIF,GAAQD,EAAKI,WAAWpG,GAAK,EACpDgG,EAAOC,GAGX,OAAOD,EAfT;CAkBA,SAAgBK,EAAiB3C,EAAc4C,GAC7C,IAAI5C,EAAI6C,kBAAmB,OAC3B,MAAMC,EAAO9C,EAAI+C,cAAcC,yBAC/BC,MAAMC,KAAKlD,EAAImD,YAAYC,QAAQN,EAAKO,YAAaP,GACrDF,EAAKS,YAAYP,GAJnB,qBAOA,SAAgBQ,EAAeC,GAC7B,GAAGA,EAAEC,aAAeD,EAAEE,iBACpBF,EAAEG,iBACJH,EAAEI,kBAHJ,mBAQA,SAAgBC,EAAUC,EAAc7D,KAAkC8D,GACxE,OAAO,IAAIxE,QAAQC,GAAWS,EAAIvD,KAAKoH,KAAYC,EAAMvE,IAD3D,cAIA,SAAgBwE,EAAUC,EAAkBC,EAA4BC,OAAOC,U,MAC7E,MAAMC,EAAgBH,EAAKI,iBAAsC,SACjE,IAAIC,EACJ,IAAI,IAAIhI,EAAI8H,EAAc5B,OAAS,EAAGlG,GAAK,EAAGA,IAAK,CACjD,MAAM,MAAEiI,GAAUH,EAAc9H,GAChC,IAAIiI,EAAO,SACX,IAAID,EAAWA,EAAYC,EAC3B,IAAI,IAAIC,EAAID,EAAME,MAAMjC,OAAS,EAAGgC,GAAK,EAAGA,IAAK,CAC/C,MAAME,EAAOH,EAAME,MAAMD,GACzB,GAAGE,EAAKC,OAASC,QAAQC,WACvB,SACF,IAAI,MAAMC,KAAmBJ,EAAsBK,aAAaC,MAAM,KACpE,GAAGF,EAAeG,SAAWjB,EAC3B,OAAOU,GAGf,IAAIJ,EAAW,CACb,MAAMH,GAAQ,EAAGF,EAAKlB,iBAAa,mBAAIkB,EACvCK,GACGH,EAASe,2BAA2BC,WACpChB,EAASd,YAAYc,EAASiB,gBAAgB,EAAA5G,OAAQ,UACvD2F,EAASkB,KAAKhC,YAAYc,EAASmB,cAAc,WACjDf,MAEJ,MAAMgB,EAAQjB,EAAUkB,WAAW,GAAGxB,OAAeM,EAAUG,MAAMjC,OAAS,GAC9E,OAAO8B,EAAUmB,SAASF,GAzB5B,e;yEC3HA,aACA,aACA,aACA,aACA,aACA,aAEA,MAAMG,EAAgB,iBAYtB,MAAaC,EAyDX,YAAY1B,EAAgDE,U,UApC5D,KAAAhE,MAAgB,EAChB,KAAAE,OAAiB,EACjB,KAAAuF,SAAmB,EACnB,KAAAC,SAAmB,EACnB,KAAA3E,KAAe,EAIP,KAAA4E,IAAc,EACd,KAAAC,IAAc,GA4BpB,EAAA9B,EAAK+B,cAAc,gBAAY,0BAAEC,UAAUC,OAAO,YAClDC,KAAKlC,KAAOA,EAAK+B,cAAc,OAC/B,EAAAI,iBAAiBD,KAAKlC,MACtBkC,KAAKhC,SAAWF,aAAgBoC,SAAWpC,EAAOkC,KAAKlC,KAAKlB,cAC5DoD,KAAKG,aAAerC,EAAK+B,cAA2B,QACpDG,KAAKI,YAAc,EAAAxC,UAAU,QAASE,GACtCkC,KAAKK,UAAYvC,EAAK+B,cAA2B,QACjDG,KAAKM,cAAgBxC,EAAK+B,cAA2B,SACrDG,KAAKO,SAAWzC,EAAK+B,cAA8B,aACnDG,KAAKQ,YAAc1C,EAAK+B,cAAgC,eACxDG,KAAKS,UAAY3C,EAAK+B,cAA2B,SACjDG,KAAKU,SAAW5C,EAAK+B,cAA+B,iBACpDG,KAAKU,SAASjH,iBAAiB,SAAUuG,KAAKW,aAAahJ,KAAKqI,OAChEA,KAAKU,SAASjH,iBAAiB,QAASuG,KAAKY,YAAYjJ,KAAKqI;CAC9DA,KAAKlC,KAAKrE,iBAAiB,QAASuG,KAAKa,QAAQlJ,KAAKqI,MAAO,MAC7D,EAAAC,iBAAiBD,KAAKlC,KAAK+B,cAA0B,SAAWG,KAAKc,WAAWnJ,KAAKqI,OACrFA,KAAKe,cAAgBf,KAAKU,SAASb,cAAgC,qBACnEG,KAAKe,cAActH,iBAAiB,SAAUuG,KAAKgB,gBAAgBrJ,KAAKqI,OACxEA,KAAKiB,YAAcjB,KAAKU,SAASb,cAAgC,mBACjE,MAAMqB,EAAclB,KAAKkB,YAAYvJ,KAAKqI,MAC1CA,KAAKiB,YAAYxH,iBAAiB,SAAUyH,GAC5ClB,KAAKiB,YAAYxH,iBAAiB,OAAQyH,GAC1ClB,KAAKmB,YAAcnB,KAAKU,SAASb,cAAgC,mBACjE,MAAMuB,EAAcpB,KAAKoB,YAAYzJ,KAAKqI,MAC1CA,KAAKmB,YAAY1H,iBAAiB,SAAU2H,GAC5CpB,KAAKmB,YAAY1H,iBAAiB,OAAQ2H,GAC1CpB,KAAKqB,iBAAmBrB,KAAKU,SAASb,cAA+B,eACrEG,KAAKsB,qBAAuBtB,KAAKU,SAASb,cAAgC,uBAC1EG,KAAKuB,aAAevB,KAAKU,SAASb,cAAgC,eAClEG,KAAKwB,aAAexB,KAAKU,SAASb,cAAiC;EACnE,EAAAG,KAAKlC,KAAK+B,cAAc,gBAAY,0BAAEpG,iBAAiB,QAASuG,KAAKyB,KAAK9J,KAAKqI,QAC/E,EAAAA,KAAKlC,KAAK+B,cAAc,iBAAa,0BAAEpG,iBAAiB,QAASuG,KAAK0B,KAAK/J,KAAKqI,OAChFA,KAAK2B,aAAe7D,EAAK+B,cAA+B,aACxD9B,OAAOtE,iBAAiB,SAAUuG,KAAK4B,eAAejK,KAAKqI,OAC3DnJ,OAAOgL,OAAO7B,KAAM,EAAA8B,kBAClBhE,EAAMkC,KAAK+B,OAAOpK,KAAKqI,MAAOA,KAAKgC,OAAOrK,KAAKqI,QAEjDA,KAAKiC,OACLjC,KAAK4B,iBA/DP,aACE,OAAO5B,KAAKL,IAEd,WAAWvI,GACT4I,KAAKL,IAAMvI,EACX4I,KAAKJ,IAAM9G,KAAKD,MAAMzB,EAAQ4I,KAAKhG,MAAQgG,KAAK9F,QAChD,GAAG8F,KAAKJ,IAAM,IAAM7G,OAAOmJ,SAASlC,KAAKJ,KAAM,CAC7CI,KAAKL,IAAM7G,KAAKD,MAAM,EAAImH,KAAK9F,OAAS8F,KAAKhG,OAC7CgG,KAAKJ,IAAM,GAIf,aACE,OAAOI,KAAKJ,IAEd,WAAWxI,GACT4I,KAAKJ,IAAMxI,EACX4I,KAAKL,IAAM7G,KAAKD,MAAMzB,EAAQ4I,KAAK9F,OAAS8F,KAAKhG,OACjD,GAAGgG,KAAKL,IAAM,IAAM5G,OAAOmJ,SAASlC,KAAKL,KAAM,CAC7CK,KAAKL,IAAM,EACXK,KAAKJ,IAAM9G,KAAKD,MAAM,EAAImH,KAAKhG,MAAQgG,KAAK9F,SA8ChD,kBAAkBiI,GAChB,MAAMtI,EAAMsI,aAAqBC,WAAa,EAAAnJ,OAAOkJ,GAAaA,EAClE,MAAM,MAAEnI,EAAK,OAAEE,SAAiB,EAAAN,mBAAmBC,GACnDmG,KAAKqC,SAAWxI,EAChBmG,KAAKhG,MAAQA;CACbgG,KAAK9F,OAASA,EACd8F,KAAKsC,OAASxJ,KAAKD,MAAMmB,EAAQ,KACjCgG,KAAKiB,YAAYsB,cAAgBvC,KAAKsC,OACtCtC,KAAKmB,YAAYoB,cAAgBvC,KAAKwC,OACtCxC,KAAKyC,eACL,GAAGzC,KAAKuB,aAAa1H,IAAI6I,WAAW,SAClCC,IAAIC,gBAAgB5C,KAAKuB,aAAa1H,KACxCmG,KAAKuB,aAAa1H,IAAMsI,aAAqBC,KAAOO,IAAIE,gBAAgBV,GAAatI,EACrFmG,KAAKwB,aAAasB,SAAW,MAC7B9C,KAAKiB,YAAY6B,SAAW,MAC5B9C,KAAKmB,YAAY2B,SAAW,MAG9B,oBACE9C,KAAKN,SAAW5G,KAAKiK,IAAI,EAAGjK,KAAKkK,MAAMhD,KAAKhG,MAAQgG,KAAKL,MAAQ,GAAKK,KAAK9F,OAAS8F,KAAKJ,MAAQ,GAAK,IAGxG,OACE,EAAAxF,cAAc4F,KAAKK,WACnB,EAAAjG,cAAc4F,KAAKM,eACnB,EAAAlG,cAAc4F,KAAKG,cACnB,EAAA8C,iBACA,MAAMC,EAAWlD,KAAKL,IAAM,IAC5BK,KAAK9F,QAAUgJ,EAAWlD,KAAKhG,MAC/BgG,KAAKhG,MAAQkJ,EACblD,KAAKjF,KAAO,EACZiF,KAAKP,SAAW,EAChBO,KAAKmD,UAAY,IAAI9H,KACrB2E,KAAKoD,2BACEpD,KAAKqD,eACLrD,KAAKsD,WACZtD,KAAKO,SAASjG,YAAc,QAC5B,GAAG0F,KAAKuD,OAAS,KAAM,CACrBC,cAAcxD,KAAKuD,cACZvD,KAAKuD,MAEd,MAAME,EAAQ,IAAI,EAAAC,gBAAgB,CAChC1J,MAAOgG,KAAKhG,MACZE,OAAQ8F,KAAK9F,OACboI,OAAQtC,KAAKL,IACb6C,OAAQxC,KAAKJ;AACb+D,OAAQ7K,KAAK8K,IAAI5D,KAAKhG,MAAQgG,KAAKL,IAAKK,KAAK9F,OAAS8F,KAAKJ,KAAO,EAClEiE,aAAc7D,KAAKsB,qBAAqBwC,UACvCC,cAAc/D,KAAKhC,SAAUgC,KAAKK,WACrC,MAAM2D,EAAYlL,KAAKiK,IAAI,IAAK/C,KAAKhG,MAAQ,KAC7C,MAAMiK,EAAanL,KAAKiK,IAAI,IAAK/C,KAAK9F,OAAS,KAC/C8F,KAAKlC,KAAKoG,aAAa,UAAW,OAAOF,KAAaC,KACtDjE,KAAK2B,aAAawC,KAAKC,QAAUpE,KAAKqC,SACtCrC,KAAK2B,aAAauC,aAAa,QAASlE,KAAKhG,MAAMY,YACnDoF,KAAK2B,aAAauC,aAAa,SAAUlE,KAAK9F,OAAOU,YACrD,MAAMyJ,EAAOrE,KAAKhC,SAASnB,yBAC3B,MAAMyD,EAAgBN,KAAKhC,SAASnB,yBACpC,IAAI,MAAMyH,KAAQb,EAAO,CACvB,MAAMc,EAAOF,EAAKnH,YAAY8C,KAAKhC,SAASiB,gBAAgB,EAAA5G,OAAQ,SACpEkM,EAAKC,GAAK,GAAGF,EAAKE,OAElB,MAAMC,EAAWF,EAAKrH,YAAY8C,KAAKhC,SAASiB,gBAAgB,EAAA5G,OAAQ,QACxEoM,EAASN,KAAKC,QAAU,IAAIE,EAAKE,KAEjC,MAAME,EAAWpE,EAAcpD,YAAY8C,KAAKhC,SAASiB,gBAAgB,EAAA5G,OAAQ,MACjFqM,EAASF,GAAK,GAAGF,EAAKE,OACtBE,EAAS5E,UAAU6E,IAAI,aAEvB,MAAMC,EAAOF,EAASxH,YAAY8C,KAAKhC,SAASiB,gBAAgB,EAAA5G,OAAQ,QACxEuM,EAAKT,KAAKC,QAAU,IAAIpE,KAAK2B,aAAa6C,KAC1CI,EAAKV,aAAa,OAAQ,QAAQK,EAAKC;CAEvC,MAAMK,EAAWH,EAASxH,YAAY8C,KAAKhC,SAASiB,gBAAgB,EAAA5G,OAAQ,QAC5EwM,EAAS/E,UAAU6E,IAAI,UAAW,aAClCE,EAASV,KAAKC,QAAU,IAAIE,EAAKE,KAEjC,MAAMjO,EAAIgJ,EAAcuF,KAAKR,EAAKE,IAClC,GAAGjO,EAAG,CACJ,MAAMwO,EAAI/E,KAAKhG,MAAQgG,KAAKL,IAC5B,MAAMqF,EAAIhF,KAAK9F,OAAS8F,KAAKJ,IAC7B8E,EAASO,UAAUb,QAAQc,WAAWlF,KAAKlC,KAAKqH,sBAAsBC,aACpEtM,KAAKD,MAAMC,KAAKuM,UAAYrB,EAAYe,GAAKO,SAAS/O,EAAE,GAAI,IAAMwO,GAClEjM,KAAKD,MAAMC,KAAKuM,UAAYpB,EAAae,GAAKM,SAAS/O,EAAE,GAAI,IAAMyO,KAIzEhF,KAAKG,aAAajD,YAAYmH,GAC9BrE,KAAKM,cAAcpD,YAAYoD,GAC/BN,KAAKuF,kBACLvF,KAAK4B,iBAGC,OAAO4D,GACbA,EAAQ1F,UAAU6E,IAAI,YACtB,GAAG3E,KAAKuD,OAAS,KAAM,OACvBvD,KAAKsD,WAAa,IAAIjI,KACtB2E,KAAKuD,MAAQxF,OAAO0H,YAAYzF,KAAK0F,WAAW/N,KAAKqI,MAAO,KAC5DA,KAAK0F,aAGC,OAAOC,GACbA,EAAMH,QAAQ1F,UAAUC,OAAO,YAC/B,MAAM,GAAEyE,GAAOmB,EAAMC,OAAOC,WAC5B,MAAMtP,EAAIgJ,EAAcuF,KAAKN,GAC7B,IAAIjO,EAAG,OACP,MAAMuP,EAAIR,SAAS/O,EAAE,GAAI,IACzB,MAAMwP,EAAIT,SAAS/O,EAAE,GAAI,IACzBoP,EAAMH,QAAUxF,KAAKgG,cAAcL,EAAMH,QAAS,MAAMM,EAAI,KAAKC,OACjEJ,EAAMH,QAAUxF,KAAKgG,cAAcL,EAAMH,QAAS,MAAMM,EAAI,KAAKC,OACjEJ,EAAMH,QAAUxF,KAAKgG,cAAcL,EAAMH,QAAS,MAAMM,KAAKC,EAAI;CACjEJ,EAAMH,QAAUxF,KAAKgG,cAAcL,EAAMH,QAAS,MAAMM,KAAKC,EAAI,OACjE,GAAG/F,KAAKM,cAAc5D,kBAAoB,EACxC,OACFsD,KAAKqD,QAAU,IAAIhI,KACnB,GAAG2E,KAAKuD,OAAS,KAAM,CACrBC,cAAcxD,KAAKuD,cACZvD,KAAKuD,MAEd,MAAM0C,EAAcjG,KAAKM,cAAcT,cAAkC,oBACzE,GAAGoG,EAAa,CACdA,EAAYnG,UAAUC,OAAO,aAC7BkG,EAAYhB,UAAUb,QAAQ8B,WAAW,GAE3C,MAAMlC,EAAYlL,KAAKiK,IAAI,IAAK/C,KAAKhG,MAAQ,IAC7C,MAAMiK,EAAanL,KAAKiK,IAAI,IAAK/C,KAAK9F,OAAS,IAC/C8F,KAAKlC,KAAKoG,aAAa,UAAW,OAAOF,KAAaC,KACtDjE,KAAK4B,iBACL,EAAAuE,gBAAgBnG,MAGV,cAAcoG,EAA6BC,G,MACjD,MAAMC,GAAK,EAAGtG,KAAKM,cAAcT,cAAcwG,MAAK,0BAAEE,QAA4B,cAClF,IAAID,GAAStG,KAAKwG,WAAWF,IAAUA,IAAUF,EAC/C,OAAOA,EACT,MAAMK,EAAKL,EAAQnB,UAAUb,QAC7B,IAAIqC,EAAGC,cAAe,OAAON,EAC7B,MAAMO,EAAKL,EAAMrB,UAAUb,QAC3B,IAAIuC,EAAGD,cAAe,OAAON,EAC7B,MAAMQ,EAAKH,EAAGI,QAAQ,GAAGC,OACzB,MAAMC,EAAKJ,EAAGE,QAAQ,GAAGC,OACzB,GAAGhO,KAAKkK,MAAM4D,EAAGxJ,EAAI2J,EAAG3J,IAAM,GAAKwJ,EAAGI,EAAID,EAAGC,IAAM,GAAKhH,KAAKN,SAC3D,OAAO0G,EACT,MAAMa,EAAiBb,EAAQtG,UAAUoH,SAAS,SAClD,MAAMC,EAAeb,EAAMxG,UAAUoH,SAAS,SAC9C,GAAGD,EAAgB,CACjB,IAAIE,EAAc,CAChBb,EAAMxG,UAAUC,OAAO;CACvB4G,EAAGT,WAAW,GACdE,EAAQlJ,YAAYoJ,QACf,GAAGA,EAAM5J,kBAAoB0J,EAAQ1J,kBAAmB,CAC7D,EAAAF,iBAAiB4J,EAASE,GAC1BF,EAAQrG,SACR,OAAOuG,MACF,CACL,EAAA9J,iBAAiB8J,EAAOF,GACxBE,EAAMvG,SAER,OAAOqG,EAET,GAAGe,EAAc,CACff,EAAQtG,UAAUC,OAAO,aACzB0G,EAAGP,WAAW,GACdI,EAAMpJ,YAAYkJ,GAClB,OAAOE,EAET,MAAMc,EAAWhB,EAAQP,WAAY3I,YAAY8C,KAAKhC,SAASiB,gBAAgB,EAAA5G,OAAQ,MACvF+O,EAAStH,UAAU6E,IAAI,YAAa,SACpCyC,EAASlK,YAAYkJ,GACrBA,EAAQtG,UAAUC,OAAO,aACzBqH,EAASlK,YAAYoJ,GACrBA,EAAMxG,UAAUC,OAAO,aACvB,MAAM1I,EAAIsP,EAAGE,QAAQ,GACrBJ,EAAGP,WAAW,GACdS,EAAGT,WAAW,GACdkB,EAASnC,UAAUb,QAAQc,WAAW7N,GACtC,OAAO+P,EAGD,WAAW5B,GACjB,OAAO,MAGD,aACNxF,KAAKjF,KAAOM,KAAKgM,MAAQrH,KAAKsD,WAAYgE,UAAYtH,KAAKP,SAC3DO,KAAKO,SAASjG,YAAc,EAAAQ,WAAWkF,KAAKjF,MAGtC,OACNiF,KAAKS,UAAUX,UAAU6E,IAAI,QAC7B3E,KAAKyC,eAGC,OACN,MAAM8E,EAA0BC,KAAKC,MAAMzH,KAAKQ,YAAYlG,aAAe,QAC3E,GAAGiN,GAAQ,KACT,OACFvH,KAAKhG,MAAQuN,EAAKvN,OAAS,EAC3BgG,KAAK9F,OAASqN,EAAKrN,QAAU,EAC7B8F,KAAKP,SAAW8H,EAAKxM,MAAQ,EAC7BiF,KAAKL,IAAM4H,EAAKjF,QAAU,EAC1BtC,KAAKJ,IAAM2H,EAAK/E,QAAU;CAC1B,GAAG+E,EAAKpE,WAAa,KACnBnD,KAAKmD,UAAY,IAAI9H,KAAKkM,EAAKpE,WACjC,GAAGoE,EAAKlE,SAAW,KACjBrD,KAAKqD,QAAU,IAAIhI,KAAKkM,EAAKlE,SAC/BrD,KAAKoD,oBAGC,kB,QACN,GAAGpD,KAAKsD,YAAc,MAAQtD,KAAKqD,SAAW,KAAMrD,KAAK0F,aACzD1F,KAAKQ,YAAYlG,YAAckN,KAAKE,UAAU,CAC5C1N,MAAOgG,KAAKhG,MACZE,OAAQ8F,KAAK9F,OACboI,OAAQtC,KAAKL,IACb6C,OAAQxC,KAAKJ,IACbuD,WAAS,EAAEnD,KAAKmD,aAAS,0BAAEmE,UAC3BjE,SAAO,EAAErD,KAAKqD,WAAO,0BAAEiE,UACvBvM,KAAMiF,KAAKjF,OAIP,OACNiF,KAAKuF,kBACL,OAAO,EAAAoC,iBAAiB3H,KAAKlC,KAAM,UAAUzC,KAAKgM,YAAaO,GAGzD,kBACN,MAAM,MAAEC,GAAU7H,KAAKe,cACvB,IAAI8G,IAAUA,EAAMxL,OAAQ,OAC5B,MAAMyL,EAAOD,EAAME,KAAK,GACxB/H,KAAKgI,YAAYF,GAGX,cACN9H,KAAKsC,OAAStC,KAAKiB,YAAYsB,cAC/BvC,KAAKmB,YAAYoB,cAAgBvC,KAAKwC,OACtCxC,KAAKiB,YAAYsB,cAAgBvC,KAAKsC,OACtCtC,KAAKyC,eAGC,cACNzC,KAAKwC,OAASxC,KAAKmB,YAAYoB,cAC/BvC,KAAKiB,YAAYsB,cAAgBvC,KAAKsC,OACtCtC,KAAKmB,YAAYoB,cAAgBvC,KAAKwC,OACtCxC,KAAKyC;AAGC,eACNzC,KAAKqB,iBAAiB/G,YAAc,IAAI0F,KAAKL,IAAMK,KAAKJ,cAGlD,mBAAmBxC,GACzBA,EAAEG,iBACF,IAAIyC,KAAKqC,SAAU,OACnBrC,KAAKiI,OACLjI,KAAKU,SAASwH,QAGR,cACN,GAAGlI,KAAKuB,aAAa1H,IAAI6I,WAAW,SAClCC,IAAIC,gBAAgB5C,KAAKuB,aAAa1H,KACxCmG,KAAKuB,aAAa1H,IAAM,GACxBmG,KAAKwB,aAAasB,SAAW,KAC7B9C,KAAKiB,YAAY6B,SAAW,KAC5B9C,KAAKmB,YAAY2B,SAAW,KAC5B9C,KAAKS,UAAUX,UAAUC,OAAO,QAG1B,iBACN,IAAIiE,EAAmBC,EACvB,IAAIjE,KAAKQ,YAAYlG,YAAa,CAChC,GAAGyD,OAAOoK,WAAapK,OAAOqK,YAAa,CACzCnE,EAAa,IACbD,EAAYC,EAAalG,OAAOqK,YAAcrK,OAAOoK,eAChD,CACLnE,EAAY,IACZC,EAAaD,EAAYjG,OAAOoK,WAAapK,OAAOqK,YAEtDpI,KAAKlC,KAAKoG,aAAa,UAAW,OAAOF,KAAaC,SACjD,CACL,MAAMoE,EAAUrI,KAAKlC,KAAKuK,QAAQjE,QAClCJ,EAAYqE,EAAQrO,MACpBiK,EAAaoE,EAAQnO,OAEvB,MAAMoO,EAAYtE,EAAYC,EAC9B,MAAMsE,EAAcxK,OAAOoK,WAAapK,OAAOqK,YAC/C,MAAMI,GAASF,EAAYC,EAAcvE,EAAYjG,OAAOoK,WAAalE,EAAalG,OAAOqK,aAAerK,OAAO0K,iBACnHzI,KAAKI,YAAYsI,MAAMzD,UAAY,SAASuD,KAGtC,QAAQpL;AACd,GAAG4C,KAAKS,UAAUX,UAAUoH,SAAS,SAAW9J,EAAEuL,eAAiBvL,EAAEuL,cAAcd,MAAMxL,OAAQ,CAC/F,EAAAc,eAAeC,GACf4C,KAAKc,WAAW1D,EAAEuL,gBAId,iBAAiBC,GACvB,IAAIC,EAAS,MACb,IAAI,MAAMd,KAAQa,EAAaE,MAAO,CACpC,OAAOf,EAAKgB,MACV,IAAK,OAAQ,CACX,IAAIhB,EAAKvJ,KAAKkE,WAAW,UAAW,MACpC,MAAMoF,EAAOC,EAAKiB,YAClB,IAAIlB,EAAM,MACV,IACE9H,KAAKgI,YAAYF,GACjBe,EAAS,KACT,OACF,MAEF,IAAK,SACH,OAAOd,EAAKvJ,MACV,IAAK,gBACH,IAAI,MAAMyK,WAAc,EAAAxL,UAAUsK,EAAMA,EAAKmB,cAAcrK,MAAM,QAC/D,UACQmB,KAAKgI,wBAAyBmB,MAAMF,IAAM/P,QAChD2P,EAAS,KACT,MACA,OACJ,MAEJ,MAEJ,GAAGA,EAAQ,MAEb,OAAOA,GAzaX,gBA6aA,IAAIrJ,EAEJ,SAASoI,EAAW9J,G,QAClBA,EAAKgC,UAAU6E,IAAI,aACnB,KAAA7G,EAAK+B,cAA2B,WAAO,0BAAEoF,UAAUb,QAAQyC,QAAQ,MAAC,0BAAGuC,SAAS,EAAG,K,yGCpcrF,aASA,MAAMC,EAA2C,CAC/CC,EAAG,EAAG/S,EAAG,EACTgT,EAAG,EAAGnT,EAAG,EACToT,EAAG,EAAGxE,EAAG,EACTyE,EAAG,EAAGC,EAAG,EACTC,EAAG,EAAGnT,EAAG,EACToT,EAAG,EAAGxR,EAAG,EACTyR,EAAG,EAAGC,EAAG,EACTC,EAAG,EAAG1S,EAAG,EACT2S,EAAG,EAAGC,EAAG,EACTC,EAAG,GAeL,MAAaxG,EA2BX,YAAYyG,G;CAfJ,KAAAC,QAAU,IAAIC,IACd,KAAAJ,EAAY,EACZ,KAAAK,EAAY,EACZ,KAAA9T,EAAY,EACZ,KAAAC,EAAY,EACZ,KAAA2G,EAAY,EACZ,KAAAmN,KAAgB,MAUtBvK,KAAKhG,MAAQmQ,EAAQnQ,MACrBgG,KAAK9F,OAASiQ,EAAQjQ,OACtB8F,KAAKsC,OAAS6H,EAAQ7H,OACtBtC,KAAKwC,OAAS2H,EAAQ3H,OACtBxC,KAAKwK,SAAO,EAAGL,EAAQK,WAAO,mBAAI,GAClCxK,KAAKyK,QAAM,EAAGN,EAAQM,UAAM,mBAAI,IAChCzK,KAAK7D,KAAO,EAAAD,SAAO,EAACiO,EAAQhO,QAAI,mBAAIrD,KAAK4R,MAAM5R,KAAKuM,SAAWtM,OAAO4R,mBACtE3K,KAAK2D,OAAS7K,KAAK8K,KAAG,EAACuG,EAAQxG,UAAM,mBAAI,EAAG3D,KAAK4K,GAAI5K,KAAK6K,IAC1D7K,KAAK6D,aAAesG,EAAQtG,aAAe/K,KAAKoC,MAAM8E,KAAKqF,SAAW,EAAI,GAAK,EAE/ErF,KAAK8K,SAAW,MAChB,IAAI9K,KAAK+K,GAAK,EAAG/K,KAAK+K,GAAK/K,KAAKwC,OAAQxC,KAAK+K,KAAM,CACjD/K,KAAKgL,QACL,IAAIhL,KAAKiL,GAAK,EAAGjL,KAAKiL,GAAKjL,KAAKsC,OAAQtC,KAAKiL,KAAM,CACjDjL,KAAKqG,OACLrG,KAAKkL,WAAWlL,KAAKiL,GAAKjL,KAAKsC,QAAUtC,KAAK+K,GAAK,GAAI/K,KAAKmL,eAAe,OAC3EnL,KAAKkL,WAAWlL,KAAKiL,GAAKjL,KAAKsC,OAAStC,KAAK+K,GAAI/K,KAAKmL,mBAI1DnL,KAAK8K,SAAW,KAChB,IAAI9K,KAAKiL,GAAK,EAAGjL,KAAKiL,GAAKjL,KAAKsC,OAAQtC,KAAKiL,KAAM,CACjDjL,KAAKgL,QACL,IAAIhL,KAAK+K,GAAK,EAAG/K,KAAK+K,GAAK/K,KAAKwC,OAAQxC,KAAK+K,KAAM,CACjD/K,KAAKqG,OACLrG,KAAKkL,WAAWlL,KAAKiL,GAAK,EAAIjL,KAAKsC,OAAStC,KAAK+K,GAAI/K,KAAKmL;CAC1DnL,KAAKkL,WAAWlL,KAAKiL,GAAKjL,KAAKsC,OAAStC,KAAK+K,GAAI/K,KAAKmL,eAAe,QAIzEnL,KAAK8K,SAAW,MAChB9K,KAAKkL,WAAW,EAAG,CACjBE,OAAQ,CACN,EAAG,EAAAvS,MAAMmH,KAAK6K,GAAI,GAClB,EAAG7K,KAAK2D,OACR3D,KAAK2D,OAAQ3D,KAAK2D,OAAQ,EAAG,EAAG,EAChC3D,KAAK2D,OAAQ,GAEf0H,KAAM,CAAC,IAAK,IAAK,OAGnBrL,KAAK8K,SAAW,KAChB9K,KAAKkL,WAAWlL,KAAKsC,OAAS,EAAG,CAC/B8I,OAAQ,CACN,EAAAvS,MAAMmH,KAAKhG,MAAQgG,KAAK6K,IAAK,EAC7B7K,KAAKhG,MAAQgG,KAAK2D,OAAQ,EAC1B3D,KAAK2D,OAAQ3D,KAAK2D,OAAQ,EAAG,EAAG,EAChC3D,KAAKhG,MAAOgG,KAAK2D,QAEnB0H,KAAM,CAAC,IAAK,IAAK,OAGnBrL,KAAK8K,SAAW,MAChB9K,KAAKkL,WAAWlL,KAAKsC,OAAStC,KAAKwC,OAAS,EAAG,CAC7C4I,OAAQ,CACNpL,KAAKhG,MAAO,EAAAnB,MAAMmH,KAAK9F,OAAS8F,KAAK6K,GAAI,GACzC7K,KAAKhG,MAAOgG,KAAK9F,OAAS8F,KAAK2D,OAC/B3D,KAAK2D,OAAQ3D,KAAK2D,OAAQ,EAAG,EAAG,EAChC3D,KAAKhG,MAAQgG,KAAK2D,OAAQ3D,KAAK9F,QAEjCmR,KAAM,CAAC,IAAK,IAAK,OAGnBrL,KAAK8K,SAAW,KAChB9K,KAAKkL,WAAWlL,KAAKsC,QAAUtC,KAAKwC,OAAS,GAAI,CAC/C4I,OAAQ,CACN,EAAAvS,MAAMmH,KAAK6K,GAAI,GAAI7K,KAAK9F,OACxB8F,KAAK2D,OAAQ3D,KAAK9F,OAClB8F,KAAK2D,OAAQ3D,KAAK2D,OAAQ,EAAG,EAAG,EAAG,EACnC3D,KAAK9F,OAAS8F,KAAK2D,QAErB0H,KAAM,CAAC,IAAK,IAAK,OAGnBrL,KAAKsL,MAAQ,GACb,IAAI,MAAOnV,EAAGoV,KAAWvL,KAAKoK,QAAS,CACrC,MAAMrE,EAAIjN,KAAK4R,MAAMvU,EAAI6J,KAAKsC;GAC9B,EAACtC,KAAKsL,MAAMvF,MAAE,mBAAK/F,KAAKsL,MAAMvF,GAAK,IAAK5P,EAAI6J,KAAKsC,QAAUtC,KAAKwL,oBAAoBD,GAGtFvL,KAAKoK,QAAQqB,QAtFf,SAAmB,OAAOzL,KAAK8K,SAAW9K,KAAK9F,OAAS8F,KAAKwC,OAASxC,KAAKhG,MAAQgG,KAAKsC,OACxF,SAAmB,OAAOtC,KAAK8K,SAAW9K,KAAKhG,MAAQgG,KAAKsC,OAAStC,KAAK9F,OAAS8F,KAAKwC,OACxF,SAAmB,OAAOxC,KAAK4K,IAAM5K,KAAK8K,SAAW9K,KAAK+K,GAAK/K,KAAKiL,IACpE,SAAmB,OAAOjL,KAAK6K,IAAM7K,KAAK8K,SAAW9K,KAAKiL,GAAKjL,KAAK+K,IAsFpE,cAAc/M,EAAoB0N,GAChC,MAAMhS,EAA2B,GACjC,MAAMiS,EAAWD,GAAU,KAAO1N,EAASnB,yBAA2B,KACtE,IAAI,IAAIkJ,EAAI,EAAGA,EAAI/F,KAAKsL,MAAMjP,OAAQ0J,IAAK,CACzC,MAAMkD,EAAMjJ,KAAKsL,MAAMvF,GACvB,IAAI,IAAID,EAAI,EAAGA,EAAImD,EAAI5M,OAAQyJ,IAAK,CAClC,MAAM8F,EAAM5N,EAASiB,gBAAgB,EAAA5G,OAAQ,QAC7CuT,EAAI1H,aAAa,IAAK+E,EAAInD,IAC1B8F,EAAIpH,GAAK,KAAKsB,KAAKC,IACnBrM,EAAOmS,KAAKD,GACZD,IAAQ,MAARA,SAAQ,SAARA,EAAUzO,YAAY0O,IAG1BF,IAAM,MAANA,SAAM,SAANA,EAAQxO,YAAYyO,GACpB,OAAOjS,EAGD,eAAeoS,GACrB,MAAM,EAAE7B,EAAC,EAAEK,EAAC,EAAE9T,EAAC,EAAEC,EAAC,EAAE2G,EAAC,QAAEoN,GAAYxK,KACnC,MAAM+L,EAAM/L,KAAK5J,EAAE,GACnB,MAAM4V,EAAMhM,KAAK+E,EAAE,GACnB,MAAMkH,EAAMjM,KAAK5J,EAAE,IACnB,MAAM8V,EAAMlM,KAAK+E,EAAEkF,GACnB,MAAMkC,EAAMnM,KAAK5J,EAAE,GAAMkU,EAAI7T,GAC7B,MAAM2V,EAAMpM,KAAK+E,GAAGyF,EAAUhU,GAC9B,MAAM6V,EAAMrM,KAAK5J,EAAE,GAAMoU,EAAUF,GACnC,MAAMgC,EAAMtM,KAAK+E,EAAEyF,EAAUhU,GAC7B,MAAM+V,EAAMvM,KAAK5J,EAAE,GAAM,EAAIoU,EAAUF,EAAI7T,GAC3C,MAAM+V,EAAMxM,KAAK+E,EAAE,EAAIyF,EAAUhU;CACjC,MAAMiW,EAAMzM,KAAK5J,EAAE,GAAM,EAAIoU,EAAUF,EAAI7T,GAC3C,MAAMiW,EAAM1M,KAAK+E,EAAE,EAAIyF,EAAUhU,GACjC,MAAMmW,EAAM3M,KAAK5J,EAAE,GAAMoU,EAAUF,GACnC,MAAMsC,EAAM5M,KAAK+E,EAAEyF,EAAUhU,GAC7B,MAAMqW,EAAM7M,KAAK5J,EAAE,GAAMkU,EAAI7T,GAC7B,MAAMqW,EAAM9M,KAAK+E,GAAGyF,EAAUhU,GAC9B,MAAMuW,EAAM/M,KAAK5J,EAAE,IACnB,MAAM4W,EAAMhN,KAAK+E,EAAE3H,GACnB,MAAM6P,EAAMjN,KAAK5J,EAAE,GACnB,MAAM8W,EAAMlN,KAAK+E,EAAE,GACnB,MAAO,CACLqG,OAAQpL,KAAK8K,SAAWgB,EAAU,CAChCoB,EAAKD,EAAKD,EAAKD,EAAKD,EAAKD,EAAKD,EAAKD,EACnCD,EAAKD,EAAKD,EAAKD,EAAKD,EAAKD,EAAKD,EAAKD,EACnCD,EAAKD,EAAKD,EAAKD,GACb,CACFC,EAAKD,EAAKG,EAAKD,EAAKG,EAAKD,EAAKG,EAAKD,EACnCG,EAAKD,EAAKG,EAAKD,EAAKG,EAAKD,EAAKG,EAAKD,EACnCG,EAAKD,EAAKG,EAAKD,GACbnB,EAAU,CACZmB,EAAKC,EAAKH,EAAKC,EAAKH,EAAKC,EAAKH,EAAKC,EACnCH,EAAKC,EAAKH,EAAKC,EAAKH,EAAKC,EAAKH,EAAKC,EACnCH,EAAKC,EAAKH,EAAKC,GACb,CACFD,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EACnCC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EAAKC,EACnCC,EAAKC,EAAKC,EAAKC,GAEjB7B,KAAM,CAAC,IAAK,IAAK,IAAK,MAIlB,SACN,MAAMvF,EAAIhN,KAAKqU,IAAInN,KAAK7D,QAAU,IAClC,OAAO2J,EAAIhN,KAAKoC,MAAM4K,GAGhB,aACN,OAAO9F,KAAKqF,SAAWrF,KAAKyK,OAAS,EAAIzK,KAAKyK,OAGxC,QACNzK,KAAK5C,EAAI4C,KAAKoN,aAGR,OACN,MAAMC,EAAOrN,KAAKuK,KAClB,OAAOvK,KAAK6D,cACV,KAAK,EAAG,KAAK,EACX7D,KAAKuK,MAAQvK,KAAKiL,GAAKjL,KAAK+K,IAAM,KAAO/K,KAAK6D,cAAgB7D,KAAK8K,SAAW,EAAI,IAAM,EACxF,MACF,QACE9K,KAAKuK,KAAOvK,KAAKqF,UAAY,GAC7B,MAEJrF,KAAKiK,EAAKjK,KAAKuK,OAAS8C,GAAQrN,KAAK5C,EAAI4C,KAAK5C,EAC9C4C,KAAKsK,EAAItK,KAAKoN,aACdpN,KAAKxJ,EAAIwJ,KAAKoN,aACdpN,KAAKvJ,EAAIuJ,KAAKoN,aACdpN,KAAK5C,EAAI4C,KAAKoN,aAGR,EAAE1D,GACR,OAAO,EAAA7Q,MAAMmH,KAAKsN,GAAKtN,KAAK4K,GAAKlB,EAAG,GAG9B,EAAEA,GACR,OAAO,EAAA7Q,MAAMmH,KAAKuN,GAAKvN,KAAK6K,GAAKnB,GAAK1J,KAAKuK,MAAQ,EAAI,GAAI;AAGrD,WAAWpU,EAAWoV,GAC5B,MAAMnB,EAAUpK,KAAKoK,QAAQpT,IAAIb,GACjC,GAAGiU,EACDA,EAAQyB,KAAKN,QAEbvL,KAAKoK,QAAQoD,IAAIrX,EAAG,CAACoV,IAGjB,oBAAoBnB,GAC1B,GAAGA,GAAW,OAASA,EAAQ/N,OAC7B,MAAO,GACT,GAAG+N,EAAQ/N,OAAS,EAAG,CACrB,MAAMoR,EAAY,IAAIC,IAAItD,GAC1B,MAAM1Q,EAAiB,CAAE0R,OAAQ,GAAIC,KAAM,IAC3C,MAAMoC,EAAUE,KAAM,CACpB,IAAIC,EAAQ,MACZ,IAAI,MAAMtH,KAASmH,EACjB,IAAI/T,EAAO0R,OAAO/O,OAAQ,CACxB3C,EAAO0R,OAAS9E,EAAM8E,OACtB1R,EAAO2R,KAAO/E,EAAM+E,KACpBuC,EAAQ,KACRH,EAAUI,OAAOvH,GACjB,WACK,GACLxN,KAAKmC,IAAIvB,EAAO0R,OAAO,GAAK9E,EAAM8E,OAAO9E,EAAM8E,OAAO/O,OAAS,IAAM,GACrEvD,KAAKmC,IAAIvB,EAAO0R,OAAO,GAAK9E,EAAM8E,OAAO9E,EAAM8E,OAAO/O,OAAS,IAAM,EACrE,CACA3C,EAAO0R,OAAO0C,OAAO,EAAG,KAAMxH,EAAM8E,QACpC1R,EAAO2R,KAAKyC,OAAO,EAAG,KAAMxH,EAAM+E,MAClCuC,EAAQ,KACRH,EAAUI,OAAOvH,GACjB,WACK,GACLxN,KAAKmC,IAAIqL,EAAM8E,OAAO,GAAK1R,EAAO0R,OAAO1R,EAAO0R,OAAO/O,OAAS,IAAM,GACtEvD,KAAKmC,IAAIqL,EAAM8E,OAAO,GAAK1R,EAAO0R,OAAO1R,EAAO0R,OAAO/O,OAAS,IAAM,EACtE,CACAiK,EAAM8E,OAAO0C,OAAO,EAAG,KAAMpU,EAAO0R,QACpC9E,EAAM+E,KAAKyC,OAAO,EAAG,KAAMpU,EAAO2R,MAClC3R,EAAO0R,OAAS9E,EAAM8E,OACtB1R,EAAO2R,KAAO/E,EAAM+E,KACpBuC,EAAQ,KACRH,EAAUI,OAAOvH,GACjB,MAEJ,IAAIsH,EACF,MAEJxD,EAAU,CAAC1Q,GAEb,MAAM,OAAE0R,EAAM,KAAEC,GAASjB,EAAQ,GACjC,IAAI/L,EAAI,EACR,IAAI3E,EAAS,GACb,IAAI,MAAMvD,KAAKkV,EAAM,CACnB3R,GAAUvD,EACV,MAAMK,EAAI6S,EAAalT,GACvB,GAAGK,EAAGkD,GAAU0R,EAAO2C,MAAM1P,EAAGA,GAAK7H,GAAGwX,KAAK,KAE/C,OAAOtU,EAAS,KA3QpB,qB;4BClCA,aAkBA,SAAgBoI,EACdhE,EAA4BE,SAC5B+D,EACAC,EACAiM,EAAiB,aAAcC,EAAe,YAE9C,MAAMC,EAAmB,IAAI9D,IAC7B,MAAM+D,EAAS,IAAI/D,IAEnBvM,EAAKrE,iBAAiB,YAAa4U,EAAkB,MACrDvQ,EAAKrE,iBAAiB,YAAa6U,GACnCxQ,EAAKrE,iBAAiB,UAAW8U,GACjCzQ,EAAKrE,iBAAiB,aAAc8U,GACpCzQ,EAAKrE,iBAAiB,aAAc+U,EAAkB,CAAEC,QAAS,KAAMC,QAAS,QAChF5Q,EAAKrE,iBAAiB,YAAakV,EAAiB,CAAED,QAAS,QAC/D5Q,EAAKrE,iBAAiB,WAAYmV,EAAgB,CAAEF,QAAS,QAC7D5Q,EAAKrE,iBAAiB,cAAemV,EAAgB,CAAEF,QAAS,QAEhE,SAASG,EAASzR,GAChB,MAAMuI,EAAQyI,EAAOpX,IAAIoG,EAAE0R,YAC3B,OAAOnJ,GAAUA,EAAMmJ,YAAc,OAAW1R,aAAa2R,WAAcpJ,EAAQ,KAGrF,SAASqJ,EAAiB5R,GACxB,IAAI,OAAEwI,GAAWxI,EACjB,KAAKwI,aAAkBqJ,SAAU,OACjCrJ,EAASA,EAAOW,QAAQ,GAAG0H,KAAkBC,MAAiBD,IAAiBC,KAC/E,GAAGtI,aAAkBsJ,mBACnB,OAAOtJ,EAGX,SAASyI,EAAiBjR,GACxB,GAAGA,EAAE+R,SAAW,EAAG,OACnB,MAAMvJ,EAASoJ,EAAiB5R,GAChC,IAAIwI,EAAQ,OACZwJ,EAAgBxJ,EAAQxI,EAAGA,EAAEiS,SAAWjS,EAAEkS,UAC1C,EAAAnS,eAAeC,GAGjB,SAASoR,EAAiBpR,GACxB,MAAMmS,EAAUnS,EAAEoS,cAAczH,KAAK,GACrC,IAAIwH,EAAS,OACb,MAAM3J,EAASoJ,EAAiB5R,GAChC,IAAIwI,EAAQ,OACZwJ,EAAgBxJ,EAAQ2J,EAASnS,EAAEiS,SAAWjS,EAAEkS,UAChD,EAAAnS,eAAeC,GAGjB,SAASgS,EAAgBxJ,EAA4B2J,EAAkBE,G;CACrE,MAAM3R,EAAO8H,EAAO8J,gBACpB,MAAMlK,EAAUI,EAAO+J,QAAQ1B,GAAkBrI,EAASA,EAAOW,QAA4B0H,GAC7F,GAAGE,EAAiByB,IAAIpK,GAAU,OAClC,MAAMqK,EAAarK,EAAQP,UAAUb,QACrC,IAAIyL,EAAWnJ,eAAiBmJ,EAAWhJ,QAAQ,GAAGrI,OAASsR,aAAaC,wBAAyB,CACnG,MAAM9K,EAAYnH,EAAKqH,qBACvBF,EAAUG,aAAa,EAAG,GAC1ByK,EAAWG,iBAAiB/K,EAAW,GAEzC,MAAMA,EAAY4K,EAAWhJ,QAAQ,GACrC,MAAMoJ,EAASC,EACbpS,EAAMyR,EAAS/J,EAAQK,YACvBsK,gBAAgBlL,EAAU6B,OAAOsJ,WACnC,MAAM,WAAEtB,GAAeS,EACvB,MAAM5J,EAAuB,CAC3BH,UAASI,SAAQkJ,aAAY7J,YAC7BoL,QAASJ,EAAOnK,EAChBwK,QAASL,EAAOlK,GAElBoI,EAAiBX,IAAIhI,EAASG,GAC9ByI,EAAOZ,IAAIsB,EAAYnJ,GACvB,GAAGH,EAAQ+K,aAAed,GACxB,EAAAjK,EAAQK,cAAU,0BAAE3I,YAAYsI,QAEhCG,EAAM6K,kBAAoB,KAC5BzO,IAAM,MAANA,SAAM,SAANA,EAASyD,GAGX,SAAS8I,EAAgBlR,GACvB,GAAGgR,EAAOT,MAAQvQ,EAAE+R,SAAW,GAAKsB,EAAWrT,GAC7C,EAAAD,eAAeC,GAGnB,SAASuR,EAAgBvR,GACvB,GAAGgR,EAAOT,MACRvQ,EAAEsT,eAAerU,QACjBS,MAAM7E,UAAU0Y,IAAIra,KAAK8G,EAAEsT,eAAgBD,GAAYG,SAAS,MAChE,EAAAzT,eAAeC,GAGnB,SAASqT,EAAWrT,GAClB,MAAMuI,EAAQkJ,EAASzR,GACvB,IAAIuI,EAAO,OAAO,MAClB,MAAMkL,EAAQX,EACZvK,EAAMH,QAAQkK,gBAAkBtS,EAChCuI,EAAMH,QAAQK,YAEhBgL,EAAM/K,GAAKH,EAAM0K,QACjBQ,EAAM9K,GAAKJ,EAAM2K,QACjB3K,EAAMV,UAAUG,aAAayL,EAAM/K,EAAG+K,EAAM9K,GAC5C,OAAO,KAGT,SAASwI,EAAenR;AACtB,GAAGgR,EAAOT,MAAQmD,EAAc1T,GAC9B,EAAAD,eAAeC,GAGnB,SAASwR,EAAexR,GACtB,GAAGgR,EAAOT,MACRvQ,EAAEsT,eAAerU,QACjBS,MAAM7E,UAAU0Y,IAAIra,KAAK8G,EAAEsT,eAAgBI,GAAeF,SAAS,MACnE,EAAAzT,eAAeC,GAGnB,SAAS0T,EAAc1T,G,MACrB,MAAMuI,EAAQkJ,EAASzR,GACvB,IAAIuI,EAAO,OAAO,MAClBwI,EAAiBN,OAAOlI,EAAMH,SAC9B4I,EAAOP,OAAOlI,EAAMmJ,YACpB,GAAGnJ,EAAM6K,mBACP,EAAA7K,EAAMH,QAAQK,cAAU,0BAAE3I,YAAYyI,EAAMH,SAC9CxD,IAAM,MAANA,SAAM,SAANA,EAAS2D,GACT,OAAO,KAGT,MAAO,CACL,WAAWH,GACT,OAAO2I,EAAiByB,IAAIpK,KA/HlC,sBAoIA,SAAS0K,EACPpS,EACAyR,EACA3K,GAEA,MAAMzM,EAAI2F,EAAKiT,iBACf5Y,EAAE2N,EAAIyJ,EAAQyB,QACd7Y,EAAE4N,EAAIwJ,EAAQ0B,QACd,OAAOrM,GAAQ,KAAOzM,EAAEgY,gBACtBvL,aAAgBsK,mBAChBtK,EAAKsM,eAAgBd,UACrBxL,GACEzM,I,0GClKN,aAEOgZ,eAAexJ,EAAiB9N,EAAcnD,EAAc0a,GACjE,MAAMpT,EAAWnE,EAAI+C,cACrB,MAAMkB,EAAOE,EAASqT,eAAeC,eAAe,EAAAjZ,OAAQ,MAAO,MACnE,MAAMkZ,EAAQzT,EAAK0T,WAAW3X,EAAK,MACnCiE,EAAK2T,aAAaF,EAAOzT,EAAKrD,kBACxBtB,QAAQuY,IAAI5U,MAAM7E,UAAU0Y,IAAIra,KAAKib,EAAMrT,iBAAiB,UAAWyT;OACvEP,IAAU,MAAVA,SAAU,SAAVA,EAAaG,EAAOzT,IAC1ByT,EAAMrT,iBAAiB,SAASjB,QAAQ2U,GACxCC,EAAkB/T,GAClB,MAAM5E,EAAO,IAAIkJ,KAAK,EAAC,IAAI0P,eAAgBC,kBAAkBjU,IAAQ,CAAEU,KAAM,kBAC7E,MAAMgH,EAAUxH,EAASiB,gBAAgB,EAAA3G,SAAU,KACnDkN,EAAQrB,KAAOxB,IAAIE,gBAAgB3J,GACnCsM,EAAQwM,SAAWtb,EACnB8O,EAAQyM,QACRtP,IAAIC,gBAAgB4C,EAAQrB,MAd9B,qBAiBAgN,eAAeQ,EAAcO,GAC3B,GAAGA,aAAkBC,kBAAmB,CACtC,MAAM,IAAEtY,GAAQqY,EAChB,IAAIrY,EAAK,OACTqY,EAAOE,gBAAgB,OACvBF,EAAO5X,wBAA2B6O,MAAMtP,IAAMwY,YACzC,GAAGH,aAAkBI,iBAAkB,CAC5C,MAAMnO,EAAO+N,EAAO/N,KAAKC,QACzB,IAAID,EAAM,OACV+N,EAAOE,gBAAgB,QACvBF,EAAOhV,YAAYgV,EAAOtV,cAAc2V,+BAAgCpJ,MAAMhF,IAAOkO,UAIzF,SAASR,EAAkB/T,G,MACzB,MAAME,GAAQ,EAAGF,EAAKlB,iBAAa,mBAAIkB,EACvC,MAAM0U,EAAaxU,EAASyU,iBAAiB3U,EAAM4U,WAAWC,WAC9D,MAAMC,EAAmB,GACzB,MAAMC,EAAsB,GAC5B,IAAIzM,EACJ,MAAMA,EAAUoM,EAAWM,WAAY,CACrC,KAAK1M,aAAmB2M,OAAU3M,aAAmB4M,aACnD,SACF,GAAG,EAAAta,aAAaua,KAAK7M,EAAQ8M,WAC3BN,EAAS/G,KAAKzF,QAEdyM,EAAYhH,KAAKzF,GAErB,IAAI,MAAM+M,KAAcP,EACtBO,EAAWpT,SACb,IAAI,MAAMsS,KAAQQ,EAAa,CAC7B,MAAMO,EAAWf,EAAKa;CACtB,MAAMG,EAAUD,EAASE,WAAW,EAAA3a,iBAAkB,KACtD,GAAGya,IAAaC,EAAShB,EAAKkB,YAAYlB,EAAKzV,cAAc4W,eAAeH,IAE9E,OAAOvV,EAGT,SAAS8T,EAAYlJ,G,MACnB,MAAMpO,GAAW,EAAGoO,EAAMpO,eAAW,0BAAEgZ,WAAW,EAAA1a,kBAAmB,IACrE,GAAG0B,GAAe,KAAM,OACxB,IACE,MAAMmZ,EAAQ/K,EAAMjO,WACpB,GAAIgZ,aAAiBT,eAAkB1Y,EAAYsW,SAAS,EAAArY,WAAY,CACtE,MAAMmb,EAAQhL,EAAM9L,cAAc2V,mBAAmBjY,GACrDoO,EAAMpO,YAAc,GACpBoO,EAAMxL,YAAYwW,QAElBhL,EAAMpO,YAAcA,EACtB,MACAoO,EAAMpO,YAAcA,K,0HCpExB,aAEA,MAAMqZ,EAAc3V,SAAS6B,cAAc,gBAC3C,MAAM+T,EAAmBD,EAAY9T,cAA8B,mBACnE,MAAMgU,EAAiBF,EAAY9T,cAA8B,iBACjE,MAAMiU,EAAkBH,EAAY9T,cAA8B,kBAClE,MAAMkU,EAAoBJ,EAAY9T,cAA8B,oBAEpE,SAAgBsG,EAAgB6N,GAC9BL,EAAY7T,UAAU6E,IAAI,QAC1BgP,EAAYzP,aAAa,aAAc,WACvCyP,EAAYzP,aAAa,iBAAkB,WAC3C0P,EAAiBtZ,YAAc,EAAAa,eAAe6Y,EAAY7Q,WAC1D0Q,EAAevZ,YAAc,EAAAa,eAAe6Y,EAAY3Q;CACxDyQ,EAAgBxZ,YAAc,EAAAQ,WAAWkZ,EAAYjZ,MACrDgZ,EAAkBzZ,YAAc,GAAG0Z,EAAY1R,UAAU0R,EAAYxR,WAAWwR,EAAY1R,OAAS0R,EAAYxR,iBAPnH,oBAUA,SAAgBS,IACd0Q,EAAY7T,UAAUC,OAAO,QAC7B6T,EAAiBtZ,YAAc,GAC/BuZ,EAAevZ,YAAc,GAC7BwZ,EAAgBxZ,YAAc,GAC9ByZ,EAAkBzZ,YAAc,GALlC,oB,0GCnBA,aAEA,SAAgB2F,EACduF,EACAyO,EACAC,EACAC,EACAC,GAEA,MAAMC,EAA0BJ,GAAgB,KAAO,KAAOK,EAC9D9O,EAAQ/L,iBAAiB,YAAa8a,EAAcL,IAAiB,MAAjBA,SAAiB,EAAjBA,EAAqBG,IACzE7O,EAAQ/L,iBAAiB,WAAY8a,EAAcJ,IAAgB,MAAhBA,SAAgB,EAAhBA,EAAoBE,IACvE7O,EAAQ/L,iBAAiB,YAAa8a,EAAcH,IACpD5O,EAAQ/L,iBAAiB,OAAQ8a,EAAcN,IAXjD,qBAcA,SAASM,EAAcC,GACrB,OAAOA,GAAY,KAAOpX,IACxB,EAAAD,eAAeC,GACf,GAAGA,EAAEwL,cAAgB,KACnB4L,EAASpX,EAAEwL,eACX,EAAAzL,eAGN,SAASmX,EAAuB1L,GAC9BA,EAAa6L,WAAa","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","export const NS_SVG = 'http://www.w3.org/2000/svg';\r\nexport const NS_XHTML = 'http://www.w3.org/1999/xhtml';\r\nexport const CDATA_END = String.fromCharCode(0x5D, 0x5D, 0x3E);\r\n\r\nexport const spaceMatcher = /^\\s*$/;\r\nexport const trimmableMatcher = /^\\s+|\\s+$/g;\r\nexport const styleSpaceMatcher = /(?<=^|\\W)\\s+|\\s+(?![\\w\\.\\[\\:\\*#])/g;\r\n\r\nexport function round(n: number, c = 0) {\r\n  c = 10 ** c;\r\n  return Math.round((n + Number.EPSILON) * c) / c;\r\n}\r\n\r\nexport function getUrl(blob: Blob) {\r\n  return new Promise<string>((resolve, reject) => {\r\n    const reader = new FileReader();\r\n    reader.readAsDataURL(blob);\r\n    reader.addEventListener('loadend', () =>\r\n      resolve(reader.result as string));\r\n    reader.addEventListener('error', () =>\r\n      reject(new Error('Unable to get URL from blob.')));\r\n  });\r\n}\r\n\r\nexport function getImageDimensions(src: string) {\r\n  return new Promise<{ width: number; height: number; }>((resolve, reject) => {\r\n    const img = new Image();\r\n    img.src = src;\r\n    img.addEventListener('load', () => resolve({\r\n      width: img.naturalWidth,\r\n      height: img.naturalHeight,\r\n    }));\r\n    img.addEventListener('error', () =>\r\n      reject(new Error('Could not load image from src.')));\r\n  });\r\n}\r\n\r\nexport function clearChildren(node: Node) {\r\n  node.textContent = '';\r\n  while(node.hasChildNodes())\r\n    node.removeChild(node.firstChild!);\r\n}\r\n\r\nexport function formatNumber(n: number, digits: number) {\r\n  return n.toString(10).padStart(digits, '0');\r\n}\r\n\r\nexport function formatTime(time: number) {\r\n  const absTime = Math.abs(time);\r\n  let result = `${\r\n    formatNumber(Math.floor(absTime / 6e4 % 60), 2)\r\n  }:${\r\n    formatNumber(Math.floor(absTime / 1e3 % 60), 2)\r\n  }`;\r\n  if(time < 36e5) return (time < 0 ? '-' : '') + result;\r\n  result = `${\r\n    formatNumber(Math.floor(absTime / 36e5 % 24), 2)\r\n  }:${result}`;\r\n  if(time < 864e5) return (time < 0 ? '-' : '') + result;\r\n  return `${\r\n    formatNumber(Math.floor(time / 864e5), 2)\r\n  }d ${result}`;\r\n}\r\n\r\nexport function formatDateTime(date: Date = new Date()) {\r\n  const yr = date.getFullYear();\r\n  const mo = date.getMonth();\r\n  const dy = date.getDate();\r\n  const hr = date.getHours();\r\n  const mi = date.getMinutes();\r\n  const se = date.getSeconds();\r\n  return `${\r\n    formatNumber(dy, 2)\r\n  }/${\r\n    formatNumber(mo + 1, 2)\r\n  }/${\r\n    formatNumber(yr, 4)\r\n  } ${\r\n    formatNumber(hr % 12 || 12, 2)\r\n  }:${\r\n    formatNumber(mi, 2)\r\n  }:${\r\n    formatNumber(se, 2)\r\n  } ${hr >= 12 ? 'PM' : 'AM'}`;\r\n}\r\n\r\nexport function getSeed(seed: any): number {\r\n  switch(typeof seed) {\r\n    case 'undefined':\r\n    case 'object':\r\n      if(seed == null)\r\n        seed = '';\r\n    default:\r\n      seed = seed.toString();\r\n    case 'string': {\r\n      let hash = 0;\r\n      for(let i = 0; i < seed.length; i++)\r\n        hash = Math.imul(31, hash) + seed.charCodeAt(i) | 0;\r\n      seed = hash;\r\n    }\r\n  }\r\n  return seed;\r\n}\r\n\r\nexport function transferChildren(src: Element, dest: Element) {\r\n  if(!src.childElementCount) return;\r\n  const frag = src.ownerDocument.createDocumentFragment();\r\n  Array.from(src.childNodes).forEach(frag.appendChild, frag);\r\n  dest.appendChild(frag);\r\n}\r\n\r\nexport function interceptEvent(e: Event) {\r\n  if(e.cancelable && !e.defaultPrevented)\r\n    e.preventDefault();\r\n  e.stopPropagation();\r\n}\r\n\r\nexport function toPromise<S, T>(thisArg: S, src: (this: S, callback: (result: T) => void) => void): Promise<T>;\r\nexport function toPromise(thisArg: any, src: (...args: any[]) => void, ...args: any[]): Promise<any>;\r\nexport function toPromise(thisArg: any, src: (...args: any[]) => void, ...args: any[]) {\r\n  return new Promise(resolve => src.call(thisArg, ...args, resolve));\r\n}\r\n\r\nexport function findStyle(selector: string, root: (ParentNode & Node) = window.document) {\r\n  const styleElements = root.querySelectorAll<Element & LinkStyle>('style');\r\n  let lastSheet: CSSStyleSheet | undefined;\r\n  for(let i = styleElements.length - 1; i >= 0; i--) {\r\n    const { sheet } = styleElements[i];\r\n    if(!sheet) continue;\r\n    if(!lastSheet) lastSheet = sheet;\r\n    for(let j = sheet.rules.length - 1; j >= 0; j--) {\r\n      const rule = sheet.rules[j];\r\n      if(rule.type !== CSSRule.STYLE_RULE)\r\n        continue;\r\n      for(const targetSelector of (rule as CSSStyleRule).selectorText.split(','))\r\n        if(targetSelector.trim() === selector)\r\n          return rule as CSSStyleRule;\r\n    }\r\n  }\r\n  if(!lastSheet) {\r\n    const document = root.ownerDocument ?? root as Document;\r\n    lastSheet = (\r\n      (document.documentElement instanceof SVGElement) ?\r\n      (document.appendChild(document.createElementNS(NS_SVG, 'style')) as SVGStyleElement & LinkStyle) :\r\n      document.head.appendChild(document.createElement('style'))\r\n    ).sheet!;\r\n  }\r\n  const index = lastSheet.insertRule(`${selector} {}`, lastSheet.rules.length - 1);\r\n  return lastSheet.cssRules[index] as CSSStyleRule;\r\n}\r\n","import { JigsawGenerator } from './puzzle-generator';\r\nimport { registerDraggable, DraggingState } from './drag-handler';\r\nimport { formatTime, getUrl, getImageDimensions, clearChildren, NS_SVG, toPromise, interceptEvent, transferChildren, findStyle } from './utils';\r\nimport { downloadDocument } from './xml-clone';\r\nimport { showCertificate, hideCetificate } from './certificate';\r\nimport { registerDropZone } from './dropzone';\r\n\r\nconst pathIdMatcher = /^p-(\\d+)-(\\d+)/;\r\n\r\ninterface StoredData {\r\n  width: number;\r\n  height: number;\r\n  xCount: number;\r\n  yCount: number;\r\n  time: number;\r\n  startTime?: number;\r\n  endTime?: number;\r\n}\r\n\r\nexport class MainHandler {\r\n  document: Document;\r\n  root: SVGSVGElement;\r\n  masksElement: SVGGElement;\r\n  imageElement: SVGImageElement;\r\n  uiScaleRule: CSSStyleRule;\r\n  pathGroup: SVGGElement;\r\n  instanceGroup: SVGGElement;\r\n  timeDisp: SVGTextElement;\r\n  dataElement: SVGScriptElement;\r\n  menuGroup: SVGGElement;\r\n  menuForm: HTMLFormElement;\r\n  imageSelector: HTMLInputElement;\r\n  imagePreview: HTMLImageElement;\r\n  colSelector: HTMLInputElement;\r\n  rowSelector: HTMLInputElement;\r\n  submitButton: HTMLButtonElement;\r\n  fixedPatternCheckbox: HTMLInputElement;\r\n  sizeCountDisplay: HTMLSpanElement;\r\n\r\n  imageUrl?: string;\r\n  width: number = 1;\r\n  height: number = 1;\r\n  baseTime: number = 0;\r\n  theshold: number = 3;\r\n  time: number = 0;\r\n  startTime?: Date;\r\n  endTime?: Date;\r\n  resumeTime?: Date;\r\n  private _xc: number = 2;\r\n  private _yc: number = 2;\r\n  private timer?: number;\r\n\r\n  get xCount() {\r\n    return this._xc;\r\n  }\r\n  set xCount(value: number) {\r\n    this._xc = value;\r\n    this._yc = Math.round(value / this.width * this.height);\r\n    if(this._yc < 2 || !Number.isFinite(this._yc)) {\r\n      this._xc = Math.round(2 / this.height * this.width);\r\n      this._yc = 2;\r\n    }\r\n  } \r\n\r\n  get yCount() {\r\n    return this._yc;\r\n  }\r\n  set yCount(value: number) {\r\n    this._yc = value;\r\n    this._xc = Math.round(value / this.height * this.width);\r\n    if(this._xc < 2 || !Number.isFinite(this._xc)) {\r\n      this._xc = 2;\r\n      this._yc = Math.round(2 / this.width * this.height);\r\n    }\r\n  }\r\n\r\n  constructor(root: GlobalEventHandlers & ParentNode & Node = document) {\r\n    root.querySelector('.noscript')?.classList.remove('noscript');\r\n    this.root = root.querySelector('svg')!;\r\n    registerDropZone(this.root);\r\n    this.document = root instanceof Document ? root : this.root.ownerDocument;\r\n    this.masksElement = root.querySelector<SVGGElement>('g#ms')!;\r\n    this.uiScaleRule = findStyle('.ui>*', root);\r\n    this.pathGroup = root.querySelector<SVGGElement>('g#ps')!;\r\n    this.instanceGroup = root.querySelector<SVGGElement>('g#ins')!;\r\n    this.timeDisp = root.querySelector<SVGTextElement>('text#time')!;\r\n    this.dataElement = root.querySelector<SVGScriptElement>('script#data')!;\r\n    this.menuGroup = root.querySelector<SVGGElement>('#menu')!;\r\n    this.menuForm = root.querySelector<HTMLFormElement>('form#menuform')!;\r\n    this.menuForm.addEventListener('submit', this.onMenuSubmit.bind(this));\r\n    this.menuForm.addEventListener('reset', this.onMenuReset.bind(this));\r\n    this.root.addEventListener('paste', this.onPaste.bind(this), true);\r\n    registerDropZone(this.root.querySelector<SVGElement>('#menu')!, this.onDragDrop.bind(this));\r\n    this.imageSelector = this.menuForm.querySelector<HTMLInputElement>('input#image-input')!;\r\n    this.imageSelector.addEventListener('change', this.onImageSelected.bind(this));\r\n    this.colSelector = this.menuForm.querySelector<HTMLInputElement>('input#col-input')!;\r\n    const onColChange = this.onColChange.bind(this);\r\n    this.colSelector.addEventListener('change', onColChange);\r\n    this.colSelector.addEventListener('blur', onColChange);\r\n    this.rowSelector = this.menuForm.querySelector<HTMLInputElement>('input#row-input')!;\r\n    const onRowChange = this.onRowChange.bind(this);\r\n    this.rowSelector.addEventListener('change', onRowChange);\r\n    this.rowSelector.addEventListener('blur', onRowChange);\r\n    this.sizeCountDisplay = this.menuForm.querySelector<HTMLSpanElement>('#size-count')!;\r\n    this.fixedPatternCheckbox = this.menuForm.querySelector<HTMLInputElement>('input#fixed-pattern')!;\r\n    this.imagePreview = this.menuForm.querySelector<HTMLImageElement>('img#preview')!;\r\n    this.submitButton = this.menuForm.querySelector<HTMLButtonElement>('button[type=\"submit\"]')!;\r\n    this.root.querySelector('#new-game')?.addEventListener('click', this.menu.bind(this));\r\n    this.root.querySelector('#save-game')?.addEventListener('click', this.save.bind(this));\r\n    this.imageElement = root.querySelector<SVGImageElement>('image#img')!;\r\n    window.addEventListener('resize', this.onWindowResize.bind(this));\r\n    Object.assign(this, registerDraggable(\r\n      root, this.onDrag.bind(this), this.onDrop.bind(this),\r\n    ));\r\n    this.load();\r\n    this.onWindowResize();\r\n  }\r\n\r\n  async updateImage(blobOrSrc: string | Blob) {\r\n    const src = blobOrSrc instanceof Blob ? await getUrl(blobOrSrc) : blobOrSrc;\r\n    const { width, height } = await getImageDimensions(src);\r\n    this.imageUrl = src;\r\n    this.width = width;\r\n    this.height = height;\r\n    this.xCount = Math.round(width / 100);\r\n    this.colSelector.valueAsNumber = this.xCount;\r\n    this.rowSelector.valueAsNumber = this.yCount;\r\n    this.onSizeChange();\r\n    if(this.imagePreview.src.startsWith('blob:'))\r\n      URL.revokeObjectURL(this.imagePreview.src);\r\n    this.imagePreview.src = blobOrSrc instanceof Blob ? URL.createObjectURL(blobOrSrc) : src;\r\n    this.submitButton.disabled = false;\r\n    this.colSelector.disabled = false;\r\n    this.rowSelector.disabled = false;\r\n  }\r\n\r\n  calculateTheshold() {\r\n    this.theshold = Math.max(3, Math.sqrt((this.width / this._xc) ** 2 + (this.height / this._yc) ** 2) / 20);\r\n  }\r\n\r\n  init() {\r\n    clearChildren(this.pathGroup);\r\n    clearChildren(this.instanceGroup);\r\n    clearChildren(this.masksElement);\r\n    hideCetificate();\r\n    const unitSize = this._xc * 100;\r\n    this.height *= unitSize / this.width;\r\n    this.width = unitSize;\r\n    this.time = 0;\r\n    this.baseTime = 0;\r\n    this.startTime = new Date();\r\n    this.calculateTheshold();\r\n    delete this.endTime;\r\n    delete this.resumeTime;\r\n    this.timeDisp.textContent = '--:--';\r\n    if(this.timer != null) {\r\n      clearInterval(this.timer);\r\n      delete this.timer;\r\n    }\r\n    const paths = new JigsawGenerator({\r\n      width: this.width,\r\n      height: this.height,\r\n      xCount: this._xc,\r\n      yCount: this._yc,\r\n      radius: Math.min(this.width / this._xc, this.height / this._yc) / 5,\r\n      fixedPattern: this.fixedPatternCheckbox.checked,\r\n    }).toSvgElements(this.document, this.pathGroup);\r\n    const viewWidth = Math.max(640, this.width * 1.5);\r\n    const viewHeight = Math.max(480, this.height * 1.5);\r\n    this.root.setAttribute('viewBox', `0 0 ${viewWidth} ${viewHeight}`);\r\n    this.imageElement.href.baseVal = this.imageUrl!;\r\n    this.imageElement.setAttribute('width', this.width.toString());\r\n    this.imageElement.setAttribute('height', this.height.toString());\r\n    const defs = this.document.createDocumentFragment();\r\n    const instanceGroup = this.document.createDocumentFragment();\r\n    for(const path of paths) {\r\n      const mask = defs.appendChild(this.document.createElementNS(NS_SVG, 'mask'));\r\n      mask.id = `${path.id}-m`;\r\n\r\n      const maskPath = mask.appendChild(this.document.createElementNS(NS_SVG, 'use'));\r\n      maskPath.href.baseVal = `#${path.id}`;\r\n\r\n      const instance = instanceGroup.appendChild(this.document.createElementNS(NS_SVG, 'g'));\r\n      instance.id = `${path.id}-i`;\r\n      instance.classList.add('draggable');\r\n\r\n      const base = instance.appendChild(this.document.createElementNS(NS_SVG, 'use'));\r\n      base.href.baseVal = `#${this.imageElement.id}`;\r\n      base.setAttribute('mask', `url(#${mask.id})`);\r\n\r\n      const decoPath = instance.appendChild(this.document.createElementNS(NS_SVG, 'use'));\r\n      decoPath.classList.add('handler', 'pzoverlay');\r\n      decoPath.href.baseVal = `#${path.id}`;\r\n\r\n      const m = pathIdMatcher.exec(path.id);\r\n      if(m) {\r\n        const w = this.width / this._xc;\r\n        const h = this.height / this._yc;\r\n        instance.transform.baseVal.appendItem(this.root.createSVGTransform()).setTranslate(\r\n          Math.round(Math.random() * (viewWidth - w) - parseInt(m[1], 10) * w),\r\n          Math.round(Math.random() * (viewHeight - h) - parseInt(m[2], 10) * h),\r\n        );\r\n      }\r\n    }\r\n    this.masksElement.appendChild(defs);\r\n    this.instanceGroup.appendChild(instanceGroup);\r\n    this.serializeToData();\r\n    this.onWindowResize();\r\n  }\r\n\r\n  private onDrag(element: SVGElement) {\r\n    element.classList.add('grabbing');\r\n    if(this.timer != null) return;\r\n    this.resumeTime = new Date();\r\n    this.timer = window.setInterval(this.updateTime.bind(this), 1000);\r\n    this.updateTime();\r\n  }\r\n\r\n  private onDrop(state: DraggingState) {\r\n    state.element.classList.remove('grabbing');\r\n    const { id } = state.target.parentNode as Element;\r\n    const m = pathIdMatcher.exec(id);\r\n    if(!m) return;\r\n    const x = parseInt(m[1], 10);\r\n    const y = parseInt(m[2], 10);\r\n    state.element = this.checkAndMerge(state.element, `#p-${x + 1}-${y}-i`);\r\n    state.element = this.checkAndMerge(state.element, `#p-${x - 1}-${y}-i`);\r\n    state.element = this.checkAndMerge(state.element, `#p-${x}-${y + 1}-i`);\r\n    state.element = this.checkAndMerge(state.element, `#p-${x}-${y - 1}-i`);\r\n    if(this.instanceGroup.childElementCount > 1)\r\n      return;\r\n    this.endTime = new Date();\r\n    if(this.timer != null) {\r\n      clearInterval(this.timer);\r\n      delete this.timer;\r\n    }\r\n    const lastElement = this.instanceGroup.querySelector<SVGGraphicsElement>('.draggable.group');\r\n    if(lastElement) {\r\n      lastElement.classList.remove('draggable');\r\n      lastElement.transform.baseVal.removeItem(0);\r\n    }\r\n    const viewWidth = Math.max(640, this.width + 20);\r\n    const viewHeight = Math.max(480, this.height + 40);\r\n    this.root.setAttribute('viewBox', `0 0 ${viewWidth} ${viewHeight}`);\r\n    this.onWindowResize();\r\n    showCertificate(this);\r\n  }\r\n\r\n  private checkAndMerge(current: SVGGraphicsElement, next: string) {\r\n    const other = this.instanceGroup.querySelector(next)?.closest<SVGGraphicsElement>('.draggable');\r\n    if(!other || this.isDragging(other) || other === current)\r\n      return current;\r\n    const t1 = current.transform.baseVal;\r\n    if(!t1.numberOfItems) return current;\r\n    const t2 = other.transform.baseVal;\r\n    if(!t2.numberOfItems) return current;\r\n    const m1 = t1.getItem(0).matrix;\r\n    const m2 = t2.getItem(0).matrix;\r\n    if(Math.sqrt((m1.e - m2.e) ** 2 + (m1.f - m2.f) ** 2) > this.theshold)\r\n      return current;\r\n    const currentIsGroup = current.classList.contains('group');\r\n    const otherIsGroup = other.classList.contains('group');\r\n    if(currentIsGroup) {\r\n      if(!otherIsGroup) {\r\n        other.classList.remove('draggable');\r\n        t2.removeItem(0);\r\n        current.appendChild(other);\r\n      } else if(other.childElementCount > current.childElementCount) {\r\n        transferChildren(current, other);\r\n        current.remove();\r\n        return other;\r\n      } else {\r\n        transferChildren(other, current);\r\n        other.remove();\r\n      }\r\n      return current;\r\n    }\r\n    if(otherIsGroup) {\r\n      current.classList.remove('draggable');\r\n      t1.removeItem(0);\r\n      other.appendChild(current);\r\n      return other;\r\n    }\r\n    const newGroup = current.parentNode!.appendChild(this.document.createElementNS(NS_SVG, 'g'));\r\n    newGroup.classList.add('draggable', 'group');\r\n    newGroup.appendChild(current);\r\n    current.classList.remove('draggable');\r\n    newGroup.appendChild(other);\r\n    other.classList.remove('draggable');\r\n    const t = t2.getItem(0);\r\n    t1.removeItem(0);\r\n    t2.removeItem(0);\r\n    newGroup.transform.baseVal.appendItem(t);\r\n    return newGroup;\r\n  }\r\n\r\n  private isDragging(element: SVGElement) {\r\n    return false;\r\n  }\r\n\r\n  private updateTime() {\r\n    this.time = Date.now() - this.resumeTime!.getTime() + this.baseTime;\r\n    this.timeDisp.textContent = formatTime(this.time);\r\n  }\r\n\r\n  private menu() {\r\n    this.menuGroup.classList.add('show');\r\n    this.onSizeChange();\r\n  }\r\n\r\n  private load() {\r\n    const data: StoredData | null = JSON.parse(this.dataElement.textContent || 'null');\r\n    if(data == null)\r\n      return;\r\n    this.width = data.width || 1;\r\n    this.height = data.height || 1;\r\n    this.baseTime = data.time || 0;\r\n    this._xc = data.xCount || 1;\r\n    this._yc = data.yCount || 1;\r\n    if(data.startTime != null)\r\n      this.startTime = new Date(data.startTime);\r\n    if(data.endTime != null)\r\n      this.endTime = new Date(data.endTime);\r\n    this.calculateTheshold();\r\n  }\r\n\r\n  private serializeToData() {\r\n    if(this.resumeTime != null && this.endTime == null) this.updateTime();\r\n    this.dataElement.textContent = JSON.stringify({\r\n      width: this.width,\r\n      height: this.height,\r\n      xCount: this._xc,\r\n      yCount: this._yc,\r\n      startTime: this.startTime?.getTime(),\r\n      endTime: this.endTime?.getTime(),\r\n      time: this.time,\r\n    } as StoredData);\r\n  }\r\n\r\n  private save() {\r\n    this.serializeToData();\r\n    return downloadDocument(this.root, `puzzle-${Date.now()}.svg`, beforeSave);\r\n  }\r\n\r\n  private onImageSelected() {\r\n    const { files } = this.imageSelector;\r\n    if(!files || !files.length) return;\r\n    const file = files.item(0)!;\r\n    this.updateImage(file);\r\n  }\r\n\r\n  private onColChange() {\r\n    this.xCount = this.colSelector.valueAsNumber;\r\n    this.rowSelector.valueAsNumber = this.yCount;\r\n    this.colSelector.valueAsNumber = this.xCount;\r\n    this.onSizeChange();\r\n  }\r\n\r\n  private onRowChange() {\r\n    this.yCount = this.rowSelector.valueAsNumber;\r\n    this.colSelector.valueAsNumber = this.xCount;\r\n    this.rowSelector.valueAsNumber = this.yCount;\r\n    this.onSizeChange();\r\n  }\r\n\r\n  private onSizeChange() {\r\n    this.sizeCountDisplay.textContent = `(${this._xc * this._yc} Pieces)`;\r\n  }\r\n\r\n  private async onMenuSubmit(e: Event) {\r\n    e.preventDefault();\r\n    if(!this.imageUrl) return;\r\n    this.init();\r\n    this.menuForm.reset();\r\n  }\r\n\r\n  private onMenuReset() {\r\n    if(this.imagePreview.src.startsWith('blob:'))\r\n      URL.revokeObjectURL(this.imagePreview.src);\r\n    this.imagePreview.src = '';\r\n    this.submitButton.disabled = true;\r\n    this.colSelector.disabled = true;\r\n    this.rowSelector.disabled = true;\r\n    this.menuGroup.classList.remove('show');\r\n  }\r\n\r\n  private onWindowResize() {\r\n    let viewWidth: number, viewHeight: number;\r\n    if(!this.dataElement.textContent) {\r\n      if(window.innerWidth > window.innerHeight) {\r\n        viewHeight = 480;\r\n        viewWidth = viewHeight / window.innerHeight * window.innerWidth;\r\n      } else {\r\n        viewWidth = 640;\r\n        viewHeight = viewWidth / window.innerWidth * window.innerHeight;\r\n      }\r\n      this.root.setAttribute('viewBox', `0 0 ${viewWidth} ${viewHeight}`);\r\n    } else {\r\n      const viewBox = this.root.viewBox.baseVal;\r\n      viewWidth = viewBox.width;\r\n      viewHeight = viewBox.height;\r\n    }\r\n    const viewRatio = viewWidth / viewHeight;\r\n    const windowRatio = window.innerWidth / window.innerHeight;\r\n    const scale = (viewRatio > windowRatio ? viewWidth / window.innerWidth : viewHeight / window.innerHeight) * window.devicePixelRatio;\r\n    this.uiScaleRule.style.transform = `scale(${scale})`;\r\n  }\r\n\r\n  private onPaste(e: ClipboardEvent) {\r\n    if(this.menuGroup.classList.contains('show') && e.clipboardData && e.clipboardData.files.length) {\r\n      interceptEvent(e);\r\n      this.onDragDrop(e.clipboardData);\r\n    }\r\n  }\r\n\r\n  private async onDragDrop(dataTransfer: DataTransfer) {\r\n    let loaded = false;\r\n    for(const item of dataTransfer.items) {\r\n      switch(item.kind) {\r\n        case 'file': {\r\n          if(!item.type.startsWith('image/')) break;\r\n          const file = item.getAsFile();\r\n          if(!file) break;\r\n          try {\r\n            this.updateImage(file);\r\n            loaded = true;\r\n          } catch {}\r\n          break;\r\n        }\r\n        case 'string':\r\n          switch(item.type) {\r\n            case 'text/uri-list':\r\n              for(const row of (await toPromise(item, item.getAsString)).split('\\r\\n'))\r\n                try {\r\n                  await this.updateImage(await (await fetch(row)).blob());\r\n                  loaded = true;\r\n                  break;\r\n                } catch {}\r\n              break;\r\n          }\r\n          break;\r\n      }\r\n      if(loaded) break;\r\n    }\r\n    return loaded;\r\n  }\r\n}\r\n\r\nnew MainHandler();\r\n\r\nfunction beforeSave(root: Element) {\r\n  root.classList.add('noscript');\r\n  root.querySelector<SVGGElement>('g#ui')?.transform.baseVal.getItem(0)?.setScale(1, 1);\r\n}\r\n","import { NS_SVG, getSeed, round } from './utils';\r\n// Modified from https://gist.github.com/Draradech/35d36347312ca6d0887aa7d55f366e30\r\n// Changes: Outputs per-puzzle path instead of one for all.\r\n\r\ninterface Stroke {\r\n  points: number[];\r\n  inst: string[];\r\n}\r\n\r\nconst svgArgsCount: { [arg: string]: number; } = {\r\n  M: 2, m: 2,\r\n  L: 2, l: 2,\r\n  H: 1, h: 1,\r\n  V: 1, v: 1,\r\n  C: 6, c: 6,\r\n  S: 4, s: 4,\r\n  Q: 4, q: 4,\r\n  T: 2, t: 2,\r\n  A: 7, a: 7,\r\n  z: 0,\r\n};\r\n\r\nexport interface JigsawGeneratorOptions {\r\n  width: number;\r\n  height: number;\r\n  xCount: number;\r\n  yCount: number;\r\n  seed?: any;\r\n  tabSize?: number;\r\n  jitter?: number;\r\n  radius?: number;\r\n  fixedPattern?: boolean;\r\n}\r\n\r\nexport class JigsawGenerator {\r\n  cells: string[][];\r\n  width: number;\r\n  height: number;\r\n  xCount: number;\r\n  yCount: number;\r\n  seed: number;\r\n  tabSize: number;\r\n  jitter: number;\r\n  radius: number;\r\n  fixedPattern: number;\r\n\r\n  private strokes = new Map<number, Stroke[]>();\r\n  private a: number = 0;\r\n  private b: number = 0;\r\n  private c: number = 0;\r\n  private d: number = 0;\r\n  private e: number = 0;\r\n  private flip: boolean = false;\r\n  private xi: number;\r\n  private yi: number;\r\n  private vertical: boolean;\r\n  private get sl() { return this.vertical ? this.height / this.yCount : this.width / this.xCount; }\r\n  private get sw() { return this.vertical ? this.width / this.xCount : this.height / this.yCount; }\r\n  private get ol() { return this.sl * (this.vertical ? this.yi : this.xi); }\r\n  private get ow() { return this.sw * (this.vertical ? this.xi : this.yi); }\r\n\r\n  constructor(options: JigsawGeneratorOptions) {\r\n    this.width = options.width;\r\n    this.height = options.height;\r\n    this.xCount = options.xCount;\r\n    this.yCount = options.yCount;\r\n    this.tabSize = options.tabSize ?? 0.1;\r\n    this.jitter = options.jitter ?? 0.04;\r\n    this.seed = getSeed(options.seed ?? Math.trunc(Math.random() * Number.MAX_SAFE_INTEGER));\r\n    this.radius = Math.min(options.radius ?? 0, this.sl, this.sw);\r\n    this.fixedPattern = options.fixedPattern ? Math.floor(this.random() * 2 + 1) : 0;\r\n\r\n    this.vertical = false;\r\n    for(this.yi = 1; this.yi < this.yCount; this.yi++) {\r\n      this.first();\r\n      for(this.xi = 0; this.xi < this.xCount; this.xi++) {\r\n        this.next();\r\n        this.pushStroke(this.xi + this.xCount * (this.yi - 1), this.generateStroke(true));\r\n        this.pushStroke(this.xi + this.xCount * this.yi, this.generateStroke());\r\n      }\r\n    }\r\n\r\n    this.vertical = true;\r\n    for(this.xi = 1; this.xi < this.xCount; this.xi++) {\r\n      this.first();\r\n      for(this.yi = 0; this.yi < this.yCount; this.yi++) {\r\n        this.next();\r\n        this.pushStroke(this.xi - 1 + this.xCount * this.yi, this.generateStroke());\r\n        this.pushStroke(this.xi + this.xCount * this.yi, this.generateStroke(true));\r\n      }\r\n    }\r\n\r\n    this.vertical = false;\r\n    this.pushStroke(0, {\r\n      points: [\r\n        0, round(this.sw, 3),\r\n        0, this.radius,\r\n        this.radius, this.radius, 0, 0, 1,\r\n        this.radius, 0,\r\n      ],\r\n      inst: ['M', 'L', 'A'],\r\n    });\r\n\r\n    this.vertical = true;\r\n    this.pushStroke(this.xCount - 1, {\r\n      points: [\r\n        round(this.width - this.sw), 0,\r\n        this.width - this.radius, 0,\r\n        this.radius, this.radius, 0, 0, 1,\r\n        this.width, this.radius,\r\n      ],\r\n      inst: ['M', 'L', 'A'],\r\n    });\r\n\r\n    this.vertical = false;\r\n    this.pushStroke(this.xCount * this.yCount - 1, {\r\n      points: [\r\n        this.width, round(this.height - this.sw, 3),\r\n        this.width, this.height - this.radius,\r\n        this.radius, this.radius, 0, 0, 1,\r\n        this.width - this.radius, this.height,\r\n      ],\r\n      inst: ['M', 'L', 'A'],\r\n    });\r\n\r\n    this.vertical = true;\r\n    this.pushStroke(this.xCount * (this.yCount - 1), {\r\n      points: [\r\n        round(this.sw, 3), this.height,\r\n        this.radius, this.height,\r\n        this.radius, this.radius, 0, 0, 1, 0,\r\n        this.height - this.radius,\r\n      ],\r\n      inst: ['M', 'L', 'A'],\r\n    });\r\n\r\n    this.cells = [];\r\n    for(const [i, stroke] of this.strokes) {\r\n      const y = Math.trunc(i / this.xCount);\r\n      (this.cells[y] ?? (this.cells[y] = []))[i % this.xCount] = this.getNormalizedStroke(stroke);\r\n    }\r\n\r\n    this.strokes.clear();\r\n  }\r\n\r\n  toSvgElements(document: Document, parent?: Node) {\r\n    const result: SVGPathElement[] = [];\r\n    const fragment = parent != null ? document.createDocumentFragment() : null;\r\n    for(let y = 0; y < this.cells.length; y++) {\r\n      const row = this.cells[y];\r\n      for(let x = 0; x < row.length; x++) {\r\n        const elm = document.createElementNS(NS_SVG, 'path');\r\n        elm.setAttribute('d', row[x]);\r\n        elm.id = `p-${x}-${y}`;\r\n        result.push(elm);\r\n        fragment?.appendChild(elm);\r\n      }\r\n    }\r\n    parent?.appendChild(fragment!);\r\n    return result;\r\n  }\r\n\r\n  private generateStroke(reverse?: boolean): Stroke {\r\n    const { a, b, c, d, e, tabSize } = this;\r\n    const p0l = this.l(0);\r\n    const p0w = this.w(0);\r\n    const p1l = this.l(0.2);\r\n    const p1w = this.w(a);\r\n    const p2l = this.l(0.5 + b + d);\r\n    const p2w = this.w(-tabSize + c);\r\n    const p3l = this.l(0.5 - tabSize + b);\r\n    const p3w = this.w(tabSize + c);\r\n    const p4l = this.l(0.5 - 2 * tabSize + b - d);\r\n    const p4w = this.w(3 * tabSize + c);\r\n    const p5l = this.l(0.5 + 2 * tabSize + b - d);\r\n    const p5w = this.w(3 * tabSize + c);\r\n    const p6l = this.l(0.5 + tabSize + b);\r\n    const p6w = this.w(tabSize + c);\r\n    const p7l = this.l(0.5 + b + d);\r\n    const p7w = this.w(-tabSize + c);\r\n    const p8l = this.l(0.8);\r\n    const p8w = this.w(e);\r\n    const p9l = this.l(1);\r\n    const p9w = this.w(0);\r\n    return {\r\n      points: this.vertical ? reverse ? [\r\n        p9w, p9l, p8w, p8l, p7w, p7l, p6w, p6l,\r\n        p5w, p5l, p4w, p4l, p3w, p3l, p2w, p2l,\r\n        p1w, p1l, p0w, p0l,\r\n      ] : [\r\n        p0w, p0l, p1w, p1l, p2w, p2l, p3w, p3l,\r\n        p4w, p4l, p5w, p5l, p6w, p6l, p7w, p7l,\r\n        p8w, p8l, p9w, p9l,\r\n      ] : reverse ? [\r\n        p9l, p9w, p8l, p8w, p7l, p7w, p6l, p6w,\r\n        p5l, p5w, p4l, p4w, p3l, p3w, p2l, p2w,\r\n        p1l, p1w, p0l, p0w,\r\n      ] : [\r\n        p0l, p0w, p1l, p1w, p2l, p2w, p3l, p3w,\r\n        p4l, p4w, p5l, p5w, p6l, p6w, p7l, p7w,\r\n        p8l, p8w, p9l, p9w,\r\n      ],\r\n      inst: ['M', 'C', 'C', 'C'],\r\n    };\r\n  }\r\n\r\n  private random() {\r\n    const x = Math.sin(this.seed++) * 10000;\r\n    return x - Math.floor(x);\r\n  }\r\n\r\n  private nextJitter() {\r\n    return this.random() * this.jitter * 2 - this.jitter;\r\n  }\r\n\r\n  private first() {\r\n    this.e = this.nextJitter();\r\n  }\r\n\r\n  private next() {\r\n    const filp = this.flip;\r\n    switch(this.fixedPattern) {\r\n      case 1: case 2:\r\n        this.flip = (this.xi + this.yi) % 2 === (this.fixedPattern + (this.vertical ? 1 : 0)) % 2;\r\n        break;\r\n      default:\r\n        this.flip = this.random() >= 0.5;\r\n        break;\r\n    }\r\n    this.a = (this.flip === filp ? -this.e : this.e);\r\n    this.b = this.nextJitter();\r\n    this.c = this.nextJitter();\r\n    this.d = this.nextJitter();\r\n    this.e = this.nextJitter();\r\n  }\r\n\r\n  private l(v: number) {\r\n    return round(this.ol + this.sl * v, 3);\r\n  }\r\n\r\n  private w(v: number) {\r\n    return round(this.ow + this.sw * v * (this.flip ? -1 : 1), 3);\r\n  }\r\n\r\n  private pushStroke(i: number, stroke: Stroke) {\r\n    const strokes = this.strokes.get(i);\r\n    if(strokes)\r\n      strokes.push(stroke);\r\n    else\r\n      this.strokes.set(i, [stroke]);\r\n  }\r\n\r\n  private getNormalizedStroke(strokes: Stroke[]) {\r\n    if(strokes == null || !strokes.length)\r\n      return '';\r\n    if(strokes.length > 1) {\r\n      const strokeSet = new Set(strokes);\r\n      const result: Stroke = { points: [], inst: [] };\r\n      while(strokeSet.size) {\r\n        let found = false;\r\n        for(const other of strokeSet)\r\n          if(!result.points.length) {\r\n            result.points = other.points;\r\n            result.inst = other.inst;\r\n            found = true;\r\n            strokeSet.delete(other);\r\n            break;\r\n          } else if(\r\n            Math.abs(result.points[0] - other.points[other.points.length - 2]) < 1 &&\r\n            Math.abs(result.points[1] - other.points[other.points.length - 1]) < 1\r\n          ) {\r\n            result.points.splice(0, 2, ...other.points);\r\n            result.inst.splice(0, 1, ...other.inst);\r\n            found = true;\r\n            strokeSet.delete(other);\r\n            break;\r\n          } else if(\r\n            Math.abs(other.points[0] - result.points[result.points.length - 2]) < 1 &&\r\n            Math.abs(other.points[1] - result.points[result.points.length - 1]) < 1\r\n          ) {\r\n            other.points.splice(0, 2, ...result.points);\r\n            other.inst.splice(0, 1, ...result.inst);\r\n            result.points = other.points;\r\n            result.inst = other.inst;\r\n            found = true;\r\n            strokeSet.delete(other);\r\n            break;\r\n          }\r\n        if(!found)\r\n          break;\r\n      }\r\n      strokes = [result];\r\n    }\r\n    const { points, inst } = strokes[0];\r\n    let j = 0;\r\n    let result = '';\r\n    for(const i of inst) {\r\n      result += i;\r\n      const c = svgArgsCount[i];\r\n      if(c) result += points.slice(j, j += c).join(' ');\r\n    }\r\n    return result + 'z';\r\n  }\r\n}\r\n","import { interceptEvent } from './utils';\r\n\r\nexport interface DraggingState {\r\n  target: SVGGraphicsElement;\r\n  element: SVGGraphicsElement;\r\n  identifier?: number;\r\n  transform: SVGTransform;\r\n  offsetX: number;\r\n  offsetY: number;\r\n  bringToFrontAfter?: boolean;\r\n}\r\n\r\ninterface Pointer {\r\n  clientX: number;\r\n  clientY: number;\r\n  identifier?: number;\r\n}\r\n\r\nexport function registerDraggable(\r\n  root: GlobalEventHandlers = document,\r\n  onDrag?: (element: SVGElement) => void,\r\n  onDrop?: (state: DraggingState) => void,\r\n  draggableClass = '.draggable', handlerClass = '.handler',\r\n) {\r\n  const draggingElements = new Map<SVGElement, DraggingState>();\r\n  const states = new Map<number | undefined, DraggingState>();\r\n\r\n  root.addEventListener('mousedown', onMouseStartDrag, true);\r\n  root.addEventListener('mousemove', onMouseDragging);\r\n  root.addEventListener('mouseup', onMouseEndDrag);\r\n  root.addEventListener('mouseleave', onMouseEndDrag);\r\n  root.addEventListener('touchstart', onTouchStartDrag, { capture: true, passive: false });\r\n  root.addEventListener('touchmove', onTouchDragging, { passive: false });\r\n  root.addEventListener('touchend', onTouchEndDrag, { passive: false });\r\n  root.addEventListener('touchcancel', onTouchEndDrag, { passive: false });\r\n\r\n  function getState(e: Pointer) {\r\n    const state = states.get(e.identifier);\r\n    return state && (state.identifier == null) === (e instanceof MouseEvent) ? state : null;\r\n  }\r\n\r\n  function getHandlerTarget(e: Event) {\r\n    let { target } = e;\r\n    if(!(target instanceof Element)) return;\r\n    target = target.closest(`${draggableClass} ${handlerClass}, ${draggableClass}${handlerClass}`);\r\n    if(target instanceof SVGGraphicsElement)\r\n      return target;\r\n  }\r\n\r\n  function onMouseStartDrag(e: MouseEvent) {\r\n    if(e.button !== 0) return;\r\n    const target = getHandlerTarget(e);\r\n    if(!target) return;\r\n    handleStartDrag(target, e, e.ctrlKey || e.shiftKey);\r\n    interceptEvent(e);\r\n  }\r\n\r\n  function onTouchStartDrag(e: TouchEvent) {\r\n    const pointer = e.targetTouches.item(0);\r\n    if(!pointer) return;\r\n    const target = getHandlerTarget(e);\r\n    if(!target) return;\r\n    handleStartDrag(target, pointer, e.ctrlKey || e.shiftKey);\r\n    interceptEvent(e);\r\n  }\r\n\r\n  function handleStartDrag(target: SVGGraphicsElement, pointer: Pointer, forceBringToFront?: boolean) {\r\n    const root = target.ownerSVGElement!;\r\n    const element = target.matches(draggableClass) ? target : target.closest<SVGGraphicsElement>(draggableClass) as SVGGraphicsElement;\r\n    if(draggingElements.has(element)) return;\r\n    const transforms = element.transform.baseVal;\r\n    if(!transforms.numberOfItems || transforms.getItem(0).type !== SVGTransform.SVG_TRANSFORM_TRANSLATE) {\r\n      const transform = root.createSVGTransform();\r\n      transform.setTranslate(0, 0);\r\n      transforms.insertItemBefore(transform, 0);\r\n    }\r\n    const transform = transforms.getItem(0);\r\n    const offset = getLocalPoint(\r\n      root, pointer, element.parentNode! as SVGGraphicsElement,\r\n    ).matrixTransform(transform.matrix.inverse());\r\n    const { identifier } = pointer;\r\n    const state: DraggingState = {\r\n      element, target, identifier, transform,\r\n      offsetX: offset.x,\r\n      offsetY: offset.y,\r\n    };\r\n    draggingElements.set(element, state);\r\n    states.set(identifier, state);\r\n    if(element.nextSibling && forceBringToFront)\r\n      element.parentNode?.appendChild(element);\r\n    else\r\n      state.bringToFrontAfter = true;\r\n    onDrag?.(element);\r\n  }\r\n\r\n  function onMouseDragging(e: MouseEvent) {\r\n    if(states.size && e.button === 0 && handleDrag(e))\r\n      interceptEvent(e); \r\n  }\r\n\r\n  function onTouchDragging(e: TouchEvent) {\r\n    if(states.size &&\r\n      e.changedTouches.length &&\r\n      Array.prototype.map.call(e.changedTouches, handleDrag).includes(true))\r\n      interceptEvent(e);\r\n  }\r\n  \r\n  function handleDrag(e: Pointer) {\r\n    const state = getState(e);\r\n    if(!state) return false;\r\n    const coord = getLocalPoint(\r\n      state.element.ownerSVGElement!, e,\r\n      state.element.parentNode! as SVGGraphicsElement,\r\n    );\r\n    coord.x -= state.offsetX;\r\n    coord.y -= state.offsetY;\r\n    state.transform.setTranslate(coord.x, coord.y);\r\n    return true;\r\n  }\r\n\r\n  function onMouseEndDrag(e: MouseEvent) {\r\n    if(states.size && handleEndDrag(e))\r\n      interceptEvent(e);\r\n  }\r\n\r\n  function onTouchEndDrag(e: TouchEvent) {\r\n    if(states.size &&\r\n      e.changedTouches.length &&\r\n      Array.prototype.map.call(e.changedTouches, handleEndDrag).includes(true))\r\n      interceptEvent(e);\r\n  }\r\n  \r\n  function handleEndDrag(e: Pointer) {\r\n    const state = getState(e);\r\n    if(!state) return false;\r\n    draggingElements.delete(state.element);\r\n    states.delete(state.identifier);\r\n    if(state.bringToFrontAfter)\r\n      state.element.parentNode?.appendChild(state.element);\r\n    onDrop?.(state);\r\n    return true;\r\n  }\r\n\r\n  return {\r\n    isDragging(element: SVGElement) {\r\n      return draggingElements.has(element);\r\n    },\r\n  };\r\n}\r\n\r\nfunction getLocalPoint(\r\n  root: SVGSVGElement,\r\n  pointer: Pointer,\r\n  base?: DOMMatrix | SVGGraphicsElement | null,\r\n) {\r\n  const p = root.createSVGPoint();\r\n  p.x = pointer.clientX;\r\n  p.y = pointer.clientY;\r\n  return base != null ? p.matrixTransform(\r\n    base instanceof SVGGraphicsElement ?\r\n    base.getScreenCTM()!.inverse() :\r\n    base,\r\n  ) : p;\r\n}","import { CDATA_END, NS_SVG, NS_XHTML, styleSpaceMatcher, spaceMatcher, trimmableMatcher } from './utils';\r\n\r\nexport async function downloadDocument(src: Element, name: string, treatments?: (root: Element, document: Document) => (void | Promise<void>)) {\r\n  const document = src.ownerDocument;\r\n  const root = document.implementation.createDocument(NS_SVG, 'svg', null);\r\n  const clone = root.importNode(src, true);\r\n  root.replaceChild(clone, root.firstChild!);\r\n  await Promise.all(Array.prototype.map.call(clone.querySelectorAll('script'), resolveScript));\r\n  await treatments?.(clone, root);\r\n  clone.querySelectorAll('style').forEach(minifyStyle);\r\n  removeWhiteSpaces(root);\r\n  const blob = new Blob([new XMLSerializer().serializeToString(root)], { type: 'image/svg+xml' });\r\n  const element = document.createElementNS(NS_XHTML, 'a') as HTMLAnchorElement;\r\n  element.href = URL.createObjectURL(blob);\r\n  element.download = name;\r\n  element.click();\r\n  URL.revokeObjectURL(element.href);\r\n}\r\n\r\nasync function resolveScript(script: Element) {\r\n  if(script instanceof HTMLScriptElement) {\r\n    const { src } = script;\r\n    if(!src) return;\r\n    script.removeAttribute('src');\r\n    script.textContent = await (await fetch(src)).text();\r\n  } else if(script instanceof SVGScriptElement) {\r\n    const href = script.href.baseVal;\r\n    if(!href) return;\r\n    script.removeAttribute('href');\r\n    script.appendChild(script.ownerDocument.createCDATASection(await (await fetch(href)).text()));\r\n  }\r\n}\r\n\r\nfunction removeWhiteSpaces(root: Node) {\r\n  const document = root.ownerDocument ?? root as Document;\r\n  const treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT);\r\n  const removals: Text[] = [];\r\n  const checkSpaces: Text[] = [];\r\n  let current: Node | null;\r\n  while(current = treeWalker.nextNode()) {\r\n    if(!(current instanceof Text) || (current instanceof CDATASection))\r\n      continue;\r\n    if(spaceMatcher.test(current.wholeText))\r\n      removals.push(current);\r\n    else\r\n      checkSpaces.push(current);\r\n  }\r\n  for(const whiteSpace of removals)\r\n    whiteSpace.remove();\r\n  for(const text of checkSpaces) {\r\n    const original = text.wholeText;\r\n    const changed = original.replaceAll(trimmableMatcher, ' ');\r\n    if(original !== changed) text.replaceWith(text.ownerDocument.createTextNode(changed));\r\n  }\r\n  return root;\r\n}\r\n\r\nfunction minifyStyle(style: Element) {\r\n  const textContent = style.textContent?.replaceAll(styleSpaceMatcher, '');\r\n  if(textContent == null) return;\r\n  try {\r\n    const child = style.firstChild;\r\n    if((child instanceof CDATASection) && !textContent.includes(CDATA_END)) {\r\n      const cdata = style.ownerDocument.createCDATASection(textContent);\r\n      style.textContent = '';\r\n      style.appendChild(cdata);\r\n    } else\r\n      style.textContent = textContent;\r\n  } catch {\r\n    style.textContent = textContent;\r\n  }\r\n}\r\n","import { MainHandler } from '.';\r\nimport { formatTime, formatDateTime } from './utils';\r\n\r\nconst certificate = document.querySelector('#certificate')!;\r\nconst timeStartElement = certificate.querySelector<SVGTextElement>('text#time-start')!;\r\nconst timeEndElement = certificate.querySelector<SVGTextElement>('text#time-end')!;\r\nconst timeUsedElement = certificate.querySelector<SVGTextElement>('text#time-used')!;\r\nconst puzzleSizeElement = certificate.querySelector<SVGTextElement>('text#puzzle-size')!;\r\n\r\nexport function showCertificate(mainHandler: MainHandler) {\r\n  certificate.classList.add('show');\r\n  certificate.setAttribute('visibility', 'visible');\r\n  certificate.setAttribute('pointer-events', 'visible');\r\n  timeStartElement.textContent = formatDateTime(mainHandler.startTime);\r\n  timeEndElement.textContent = formatDateTime(mainHandler.endTime);\r\n  timeUsedElement.textContent = formatTime(mainHandler.time);\r\n  puzzleSizeElement.textContent = `${mainHandler.xCount}×${mainHandler.yCount} (${mainHandler.xCount * mainHandler.yCount} Pieces)`;\r\n}\r\n\r\nexport function hideCetificate() {\r\n  certificate.classList.remove('show');\r\n  timeStartElement.textContent = '';\r\n  timeEndElement.textContent = '';\r\n  timeUsedElement.textContent = '';\r\n  puzzleSizeElement.textContent = '';\r\n}","import { interceptEvent } from './utils';\r\n\r\nexport function registerDropZone(\r\n  element: GlobalEventHandlers,\r\n  dropCallback?: (dataTransfer: DataTransfer) => void,\r\n  dragEnterCallback?: ((dataTransfer: DataTransfer) => void) | null,\r\n  dragOverCallback?: ((dataTransfer: DataTransfer) => void) | null,\r\n  dragLeaveCallback?: ((dataTransfer: DataTransfer) => void) | null,\r\n) {\r\n  const dragOverFallbackHandler = dropCallback != null ? null : defaultDragOverHandler;\r\n  element.addEventListener('dragenter', wrapDragEvent(dragEnterCallback ?? dragOverFallbackHandler));\r\n  element.addEventListener('dragover', wrapDragEvent(dragOverCallback ?? dragOverFallbackHandler));\r\n  element.addEventListener('dragleave', wrapDragEvent(dragLeaveCallback));\r\n  element.addEventListener('drop', wrapDragEvent(dropCallback));\r\n}\r\n\r\nfunction wrapDragEvent(callback?: ((dataTransfer: DataTransfer) => void) | null): (e: DragEvent) => void {\r\n  return callback != null ? e => {\r\n    interceptEvent(e);\r\n    if(e.dataTransfer != null)\r\n      callback(e.dataTransfer);\r\n  } : interceptEvent;\r\n}\r\n\r\nfunction defaultDragOverHandler(dataTransfer: DataTransfer) {\r\n  dataTransfer.dropEffect = 'none';\r\n}\r\n"],"sourceRoot":""}