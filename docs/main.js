(function(t){var e={};function i(s){if(e[s]){return e[s].exports}var n=e[s]={i:s,l:false,exports:{}};t[s].call(n.exports,n,n.exports,i);n.l=true;return n.exports}i.m=t;i.c=e;i.d=function(t,e,s){if(!i.o(t,e)){Object.defineProperty(t,e,{enumerable:true,get:s})}};i.r=function(t){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(t,"__esModule",{value:true})};i.t=function(t,e){if(e&1)t=i(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var s=Object.create(null);i.r(s);Object.defineProperty(s,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s};i.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};i.d(e,"a",e);return e};i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};i.p="";return i(i.s=1)})([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{
value:true});e.getSeed=e.formatDateTime=e.formatTime=e.formatNumber=e.clearChildren=e.getImageDimensions=e.getUrl=e.round=e.NS_XHTML=e.NS_SVG=void 0;e.NS_SVG="http://www.w3.org/2000/svg";e.NS_XHTML="http://www.w3.org/1999/xhtml";function s(t,e=0){e=10**e;return Math.round((t+Number.EPSILON)*e)/e}e.round=s;function n(t){return new Promise((e,i)=>{const s=new FileReader;s.readAsDataURL(t);s.addEventListener("loadend",()=>e(s.result));s.addEventListener("error",()=>i(new Error("Unable to get URL from blob.")))})}e.getUrl=n;function r(t){return new Promise((e,i)=>{const s=new Image;s.src=t;s.addEventListener("load",()=>e({width:s.naturalWidth,height:s.naturalHeight}));s.addEventListener("error",()=>i(new Error("Could not load image from src.")))})}e.getImageDimensions=r;function o(t){while(t.hasChildNodes())t.removeChild(t.firstChild)}e.clearChildren=o;function h(t,e){return t.toString(10).padStart(e,"0")}e.formatNumber=h;function a(t){const e=Math.abs(t)
;let i=`${h(Math.floor(e/6e4%60),2)}:${h(Math.floor(e/1e3%60),2)}`;if(t<36e5)return(t<0?"-":"")+i;i=`${h(Math.floor(e/36e5%24),2)}:${i}`;if(t<864e5)return(t<0?"-":"")+i;return`${h(Math.floor(t/864e5),2)}d ${i}`}e.formatTime=a;function l(t=new Date){const e=t.getFullYear();const i=t.getMonth();const s=t.getDate();const n=t.getHours();const r=t.getMinutes();const o=t.getSeconds();return`${h(s,2)}/${h(i+1,2)}/${h(e,4)} ${h(n%12||12,2)}:${h(r,2)}:${h(o,2)} ${n>=12?"PM":"AM"}`}e.formatDateTime=l;function c(t){switch(typeof t){case"undefined":case"object":if(t==null)t="";default:t=t.toString();case"string":{let e=0;for(let i=0;i<t.length;i++)e=Math.imul(31,e)+t.charCodeAt(i)|0;t=e}}return t}e.getSeed=c},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.MainHandler=void 0;const s=i(2);const n=i(3);const r=i(0);const o=i(4);const h=i(5);const a=/^p-(\d+)-(\d+)/;class l{constructor(t=document){var e,i,s;this.width=1;this.height=1;this.baseTime=0;this.time=0;this._xc=1;this._yc=1
;(e=t.querySelector(".noscript"))===null||e===void 0?void 0:e.classList.remove("noscript");this.root=t.querySelector("svg");this.document=t instanceof Document?t:this.root.ownerDocument;this.defsElement=t.querySelector("defs");this.pathGroup=t.querySelector("g#ps");this.instanceGroup=t.querySelector("g#ins");this.timeDisp=t.querySelector("text#time");this.dataElement=t.querySelector("script#data");this.menuGroup=t.querySelector("#menu");this.menuForm=t.querySelector("form#menuform");this.menuForm.addEventListener("submit",this.onMenuSubmit.bind(this));this.menuForm.addEventListener("reset",this.onMenuReset.bind(this));this.imageSelector=this.menuForm.querySelector("input#image-input");this.imageSelector.addEventListener("change",this.onImageSelected.bind(this));this.colSelector=this.menuForm.querySelector("input#col-input");const r=this.onColChange.bind(this);this.colSelector.addEventListener("change",r);this.colSelector.addEventListener("blur",r)
;this.rowSelector=this.menuForm.querySelector("input#row-input");const o=this.onRowChange.bind(this);this.rowSelector.addEventListener("change",o);this.rowSelector.addEventListener("blur",o);this.imagePreview=this.menuForm.querySelector("img#preview");(i=this.root.querySelector("#new-game"))===null||i===void 0?void 0:i.addEventListener("click",this.menu.bind(this));(s=this.root.querySelector("#save-game"))===null||s===void 0?void 0:s.addEventListener("click",this.save.bind(this));this.imageElement=t.querySelector("image#img");this.imageUrl=this.imageElement.href.baseVal;Object.assign(this,n.registerDraggable(t,this.onDrag.bind(this),this.onDrop.bind(this)));this.load()}get xCount(){return this._xc}set xCount(t){this._xc=t;this._yc=Math.round(t/this.width*this.height)}get yCount(){return this._yc}set yCount(t){this._yc=t;this._xc=Math.round(t/this.height*this.width)}async updateImage(t){if(t instanceof Blob)t=await r.getUrl(t);const{width:e,height:i}=await r.getImageDimensions(t);this.imageUrl=t;this.width=e
;this.height=i;this._xc=Math.round(e/100);this._yc=Math.round(i/100)}init(){r.clearChildren(this.pathGroup);r.clearChildren(this.instanceGroup);for(const t of this.defsElement.querySelectorAll("mask.puzzle-mask"))t.remove();this.time=0;this.baseTime=0;this.startTime=new Date;delete this.endTime;delete this.resumeTime;this.timeDisp.textContent="--:--";if(this.timer!=null){clearInterval(this.timer);delete this.timer}const t=new s.JigsawGenerator(this.width,this.height,this._xc,this._yc,undefined,undefined,undefined,10).toSvgElements(this.document,this.pathGroup);const e=Math.max(640,this.width*1.5);const i=Math.max(480,this.height*1.5);this.root.setAttribute("viewbox",`0 0 ${e} ${i}`);this.root.setAttribute("width",e.toString(10));this.root.setAttribute("height",i.toString(10));this.imageElement.href.baseVal=this.imageUrl;this.imageElement.setAttribute("width",this.width.toString());this.imageElement.setAttribute("height",this.height.toString());for(const s of t){
const t=this.defsElement.appendChild(this.document.createElementNS(r.NS_SVG,"mask"));t.id=`${s.id}-m`;t.classList.add("puzzle-mask");const n=t.appendChild(this.document.createElementNS(r.NS_SVG,"use"));n.href.baseVal=`#${s.id}`;n.setAttribute("fill","white");const o=this.instanceGroup.appendChild(this.document.createElementNS(r.NS_SVG,"g"));o.id=`${s.id}-i`;o.classList.add("draggable");const h=o.appendChild(this.document.createElementNS(r.NS_SVG,"use"));h.href.baseVal=`#${this.imageElement.id}`;h.setAttribute("mask",`url(#${t.id})`);const l=o.appendChild(this.document.createElementNS(r.NS_SVG,"use"));l.classList.add("handler");l.href.baseVal=`#${s.id}`;l.setAttribute("stroke","black");l.setAttribute("fill","transparent");const c=a.exec(s.id);if(c){const t=this.width/this._xc;const s=this.height/this._yc;o.transform.baseVal.appendItem(this.root.createSVGTransform()).setTranslate(Math.round(Math.random()*(e-t)-parseInt(c[1],10)*t),Math.round(Math.random()*(i-s)-parseInt(c[2],10)*s))}}}onDrag(){
if(this.timer!=null)return;this.resumeTime=new Date;this.timer=window.setInterval(this.updateTime.bind(this),1e3);this.updateTime()}onDrop(t){const{id:e}=t.target.parentNode;const i=a.exec(e);if(!i)return;const s=parseInt(i[1],10);const n=parseInt(i[2],10);t.element=this.checkAndMerge(t.element,`#p-${s+1}-${n}-i`);t.element=this.checkAndMerge(t.element,`#p-${s-1}-${n}-i`);t.element=this.checkAndMerge(t.element,`#p-${s}-${n+1}-i`);t.element=this.checkAndMerge(t.element,`#p-${s}-${n-1}-i`);if(this.instanceGroup.childElementCount>1)return;this.endTime=new Date;if(this.timer!=null){clearInterval(this.timer);delete this.timer}const r=this.instanceGroup.querySelector(".draggable.group");if(r){r.classList.remove("draggable");r.transform.baseVal.removeItem(0)}h.showCertificate(this)}checkAndMerge(t,e){var i;const s=(i=this.instanceGroup.querySelector(e))===null||i===void 0?void 0:i.closest(".draggable");if(!s||this.isDragging(s)||s===t)return t;const n=t.transform.baseVal;if(!n.numberOfItems)return t
;const o=s.transform.baseVal;if(!o.numberOfItems)return t;const h=n.getItem(0).matrix;const a=o.getItem(0).matrix;if(Math.sqrt((h.e-a.e)**2+(h.f-a.f)**2)>3)return t;const l=t.classList.contains("group");const c=s.classList.contains("group");if(l){if(c){for(const e of Array.from(s.childNodes))t.appendChild(e);s.remove()}else{s.classList.remove("draggable");o.removeItem(0);t.appendChild(s)}return t}if(c){t.classList.remove("draggable");n.removeItem(0);s.appendChild(t);return s}const u=t.parentNode.appendChild(this.document.createElementNS(r.NS_SVG,"g"));u.classList.add("draggable","group");u.appendChild(t);t.classList.remove("draggable");u.appendChild(s);s.classList.remove("draggable");const d=o.getItem(0);n.removeItem(0);o.removeItem(0);u.transform.baseVal.appendItem(d);return u}isDragging(t){return false}updateTime(){this.time=Date.now()-this.resumeTime.getTime()+this.baseTime;this.timeDisp.textContent=r.formatTime(this.time)}menu(){this.menuGroup.classList.add("show")}load(){
const t=JSON.parse(this.dataElement.textContent||"null");if(t==null)return;this.width=t.width;this.height=t.height;this.baseTime=t.time;this._xc=t.xCount;this._yc=t.yCount;if(t.startTime!=null)this.startTime=new Date(t.startTime);if(t.endTime!=null)this.endTime=new Date(t.endTime)}save(){var t,e;if(this.resumeTime!=null)this.updateTime();this.dataElement.textContent=JSON.stringify({width:this.width,height:this.height,xCount:this._xc,yCount:this._yc,startTime:(t=this.startTime)===null||t===void 0?void 0:t.getTime(),endTime:(e=this.endTime)===null||e===void 0?void 0:e.getTime(),time:this.time});return o.downloadDocument(this.root,`puzzle-${Date.now()}.svg`)}async onImageSelected(){const{files:t}=this.imageSelector;if(!t||!t.length)return;const e=t.item(0);await this.updateImage(e);this.colSelector.valueAsNumber=this.xCount=Math.round(this.width/100);this.rowSelector.valueAsNumber=this.yCount;if(this.imagePreview.src.startsWith("blob:"))URL.revokeObjectURL(this.imagePreview.src)
;this.imagePreview.src=URL.createObjectURL(e)}onColChange(){this.xCount=this.colSelector.valueAsNumber;this.rowSelector.valueAsNumber=this.yCount}onRowChange(){this.yCount=this.rowSelector.valueAsNumber;this.colSelector.valueAsNumber=this.xCount}async onMenuSubmit(t){t.preventDefault();if(!this.imageUrl)return;this.init();this.menuForm.reset()}onMenuReset(){if(this.imagePreview.src.startsWith("blob:"))URL.revokeObjectURL(this.imagePreview.src);this.imagePreview.src="";this.menuGroup.classList.remove("show")}}e.MainHandler=l;new l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.JigsawGenerator=void 0;const s=i(0);const n={M:2,m:2,L:2,l:2,H:1,h:1,V:1,v:1,C:6,c:6,S:4,s:4,Q:4,q:4,T:2,t:2,A:7,a:7,z:0};class r{constructor(t,e,i,n,r,o=.1,h=.04,a=0){var l;this.width=t;this.height=e;this.xCount=i;this.yCount=n;this.seed=r;this.tabSize=o;this.jitter=h;this.radius=a;this.strokes=new Map;this.a=0;this.b=0;this.c=0;this.d=0;this.e=0;this.flip=false
;this.seed=s.getSeed(r!==null&&r!==void 0?r:Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER));this.radius=Math.min(this.radius,this.sl,this.sw);this.vertical=false;for(this.yi=1;this.yi<this.yCount;this.yi++){this.first();for(this.xi=0;this.xi<this.xCount;this.xi++){this.next();this.pushStroke(this.xi+this.xCount*(this.yi-1),this.generateStroke(true));this.pushStroke(this.xi+this.xCount*this.yi,this.generateStroke())}}this.vertical=true;for(this.xi=1;this.xi<this.xCount;this.xi++){this.first();for(this.yi=0;this.yi<this.yCount;this.yi++){this.next();this.pushStroke(this.xi-1+this.xCount*this.yi,this.generateStroke());this.pushStroke(this.xi+this.xCount*this.yi,this.generateStroke(true))}}this.vertical=false;this.pushStroke(0,{points:[0,s.round(this.sw,3),0,this.radius,this.radius,this.radius,0,0,1,this.radius,0],inst:["M","L","A"]});this.vertical=true;this.pushStroke(this.xCount-1,{points:[s.round(this.width-this.sw),0,this.width-this.radius,0,this.radius,this.radius,0,0,1,this.width,this.radius],
inst:["M","L","A"]});this.vertical=false;this.pushStroke(this.xCount*this.yCount-1,{points:[this.width,s.round(this.height-this.sw,3),this.width,this.height-this.radius,this.radius,this.radius,0,0,1,this.width-this.radius,this.height],inst:["M","L","A"]});this.vertical=true;this.pushStroke(this.xCount*(this.yCount-1),{points:[s.round(this.sw,3),this.height,this.radius,this.height,this.radius,this.radius,0,0,1,0,this.height-this.radius],inst:["M","L","A"]});this.cells=[];for(const[t,e]of this.strokes){const i=Math.trunc(t/this.xCount);((l=this.cells[i])!==null&&l!==void 0?l:this.cells[i]=[])[t%this.xCount]=this.getNormalizedStroke(e)}this.strokes.clear()}get sl(){return this.vertical?this.height/this.yCount:this.width/this.xCount}get sw(){return this.vertical?this.width/this.xCount:this.height/this.yCount}get ol(){return this.sl*(this.vertical?this.yi:this.xi)}get ow(){return this.sw*(this.vertical?this.xi:this.yi)}toSvgElements(t,e){const i=[];for(let n=0;n<this.cells.length;n++){const r=this.cells[n]
;for(let o=0;o<r.length;o++){const h=t.createElementNS(s.NS_SVG,"path");h.setAttribute("d",r[o]);h.id=`p-${o}-${n}`;i.push(h);e===null||e===void 0?void 0:e.appendChild(h)}}return i}generateStroke(t){const{a:e,b:i,c:s,d:n,e:r,tabSize:o}=this;const h=this.l(0);const a=this.w(0);const l=this.l(.2);const c=this.w(e);const u=this.l(.5+i+n);const d=this.w(-o+s);const m=this.l(.5-o+i);const f=this.w(o+s);const g=this.l(.5-2*o+i-n);const p=this.w(3*o+s);const v=this.l(.5+2*o+i-n);const S=this.w(3*o+s);const b=this.l(.5+o+i);const w=this.w(o+s);const y=this.l(.5+i+n);const x=this.w(-o+s);const C=this.l(.8);const M=this.w(r);const T=this.l(1);const E=this.w(0);return{points:this.vertical?t?[E,T,M,C,x,y,w,b,S,v,p,g,f,m,d,u,c,l,a,h]:[a,h,c,l,d,u,f,m,p,g,S,v,w,b,x,y,M,C,E,T]:t?[T,E,C,M,y,x,b,w,v,S,g,p,m,f,u,d,l,c,h,a]:[h,a,l,c,u,d,m,f,g,p,v,S,b,w,y,x,C,M,T,E],inst:["M","C","C","C"]}}random(){const t=Math.sin(this.seed++)*1e4;return t-Math.floor(t)}nextJitter(){return this.random()*this.jitter*2-this.jitter}first(){
this.e=this.nextJitter()}next(){const t=this.flip;this.flip=this.random()>=.5;this.a=this.flip===t?-this.e:this.e;this.b=this.nextJitter();this.c=this.nextJitter();this.d=this.nextJitter();this.e=this.nextJitter()}l(t){return s.round(this.ol+this.sl*t,3)}w(t){return s.round(this.ow+this.sw*t*(this.flip?-1:1),3)}pushStroke(t,e){const i=this.strokes.get(t);if(i)i.push(e);else this.strokes.set(t,[e])}getNormalizedStroke(t){if(t==null||!t.length)return"";if(t.length>1){const e=new Set(t);const i={points:[],inst:[]};while(e.size){let t=false;for(const s of e)if(!i.points.length){i.points=s.points;i.inst=s.inst;t=true;e.delete(s);break}else if(Math.abs(i.points[0]-s.points[s.points.length-2])<1&&Math.abs(i.points[1]-s.points[s.points.length-1])<1){i.points.splice(0,2,...s.points);i.inst.splice(0,1,...s.inst);t=true;e.delete(s);break}else if(Math.abs(s.points[0]-i.points[i.points.length-2])<1&&Math.abs(s.points[1]-i.points[i.points.length-1])<1){s.points.splice(0,2,...i.points);s.inst.splice(0,1,...i.inst)
;i.points=s.points;i.inst=s.inst;t=true;e.delete(s);break}if(!t)break}t=[i]}const{points:e,inst:i}=t[0];let s=0;let r="";for(const t of i){r+=t;const i=n[t];if(i)r+=e.slice(s,s+=i).join(" ")}return r+"z"}}e.JigsawGenerator=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.registerDraggable=void 0;function s(t=document,e,i,s=".draggable",o=".handler"){const h=new Map;const a=new Map;t.addEventListener("mousedown",c,true);t.addEventListener("mousemove",u);t.addEventListener("mouseup",m);t.addEventListener("mouseleave",m);t.addEventListener("touchstart",c,{capture:true,passive:false});t.addEventListener("touchmove",u,{passive:false});t.addEventListener("touchend",m,{passive:false});t.addEventListener("touchcancel",m,{passive:false});function l(t){const e=a.get(t.identifier);return e&&e.identifier==null===t instanceof MouseEvent?e:null}function c(t){var i,l,c,u,d,m
;let f=(l=(i=t.target)===null||i===void 0?void 0:i.closest)===null||l===void 0?void 0:l.call(i,`${s} ${o}, ${s}${o}`);if(!(f instanceof SVGGraphicsElement))return;const g=f.ownerSVGElement;let p;let v;const{targetTouches:S}=t;if(S){let t=f;const e=(d=(u=(c=f.parentNode)===null||c===void 0?void 0:c.getScreenCTM)===null||u===void 0?void 0:u.call(c))===null||d===void 0?void 0:d.inverse();while(t){if(t instanceof SVGUseElement){t=g.querySelector(t.href.baseVal);continue}if(t instanceof SVGGeometryElement){for(let i=0;i<S.length;i++){const s=S[i];const r=n(g,s,e);if(t.isPointInFill(r)||t.isPointInStroke(r)){v=s.identifier;p=s;break}}}else if(t instanceof SVGGraphicsElement){const t=f.getBBox();for(let i=0;i<S.length;i++){const s=S[i];const r=n(g,s,e);if(t.left<=r.x&&t.right>r.x&&t.top<=r.y&&t.bottom>r.y){v=s.identifier;p=s;break}}}break}}else{if(t.button!==0)return;p=t}if(!p)return;const b=f.matches(s)?f:f===null||f===void 0?void 0:f.closest(s);if(h.has(b))return;const w=b.transform.baseVal
;if(!w.numberOfItems||w.getItem(0).type!==SVGTransform.SVG_TRANSFORM_TRANSLATE){const t=g.createSVGTransform();t.setTranslate(0,0);w.insertItemBefore(t,0)}const y=w.getItem(0);const x=n(g,p,b.parentNode).matrixTransform(y.matrix.inverse());const C={element:b,target:f,identifier:v,transform:y,offsetX:x.x,offsetY:x.y};h.set(b,C);a.set(v,C);(m=b.parentNode)===null||m===void 0?void 0:m.appendChild(b);r(t);e===null||e===void 0?void 0:e(b)}function u(t){if(!a.size)return;const{changedTouches:e}=t;if(e?Array.prototype.map.call(e,d).includes(true):t.button===0&&d(t))r(t)}function d(t){const e=l(t);if(!e)return false;const i=n(e.element.ownerSVGElement,t,e.element.parentNode);if(!i)return false;e.transform.setTranslate(i.x-e.offsetX,i.y-e.offsetY);return true}function m(t){if(!a.size)return;const{changedTouches:e}=t;if(e?Array.prototype.map.call(e,f).includes(true):f(t))r(t)}function f(t){const e=l(t);if(!e)return false;h.delete(e.element);a.delete(e.identifier);i===null||i===void 0?void 0:i(e);return true}return{
isDragging(t){return h.has(t)}}}e.registerDraggable=s;function n(t,e,i){const s=t.createSVGPoint();s.x=e.clientX;s.y=e.clientY;return i!=null?s.matrixTransform(i instanceof SVGGraphicsElement?i.getScreenCTM().inverse():i):s}function r(t){if(t.cancelable&&!t.defaultPrevented)t.preventDefault();t.stopPropagation()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.downloadDocument=void 0;const s=i(0);async function n(t,e){const i=t.ownerDocument;const n=i.implementation.createDocument(s.NS_SVG,"svg",null);const o=n.importNode(t,true);n.replaceChild(o,n.firstChild);await Promise.all(Array.prototype.map.call(o.querySelectorAll("script"),r));const h=new Blob([(new XMLSerializer).serializeToString(n)],{type:"image/svg+xml"});const a=i.createElementNS(s.NS_XHTML,"a");a.href=URL.createObjectURL(h);a.download=e;a.click();URL.revokeObjectURL(a.href)}e.downloadDocument=n;async function r(t){if(t instanceof HTMLScriptElement){const{src:e}=t;if(!e)return;t.removeAttribute("src")
;t.textContent=await(await fetch(e)).text()}else if(t instanceof SVGScriptElement){const e=t.href.baseVal;if(!e)return;t.removeAttribute("href");t.appendChild(t.ownerDocument.createCDATASection(await(await fetch(e)).text()))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.hideCetificate=e.showCertificate=void 0;const s=i(0);const n=document.querySelector("#certificate");const r=n.querySelector("text#time-start");const o=n.querySelector("text#time-end");const h=n.querySelector("text#time-used");const a=n.querySelector("text#puzzle-size");function l(t){n.classList.add("show");n.setAttribute("visibility","visible");n.setAttribute("pointer-events","visible");r.textContent=s.formatDateTime(t.startTime);o.textContent=s.formatDateTime(t.endTime);h.textContent=s.formatTime(t.time);a.textContent=`${t.xCount}×${t.yCount} (${t.xCount*t.yCount} Pieces)`}e.showCertificate=l;function c(){n.classList.remove("show");r.textContent="";o.textContent="";h.textContent="";a.textContent=""}
e.hideCetificate=c}]);
//# sourceMappingURL=main.js.map